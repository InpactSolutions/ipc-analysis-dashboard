<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IPC Requests Analyse Dashboard</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/recharts@2.8.0/umd/Recharts.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.21/lodash.min.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            line-height: 1.6;
            color: #333;
        }
        
        .bg-gray-50 { background-color: #f9fafb; }
        .bg-gray-100 { background-color: #f3f4f6; }
        .bg-gray-200 { background-color: #e5e7eb; }
        .bg-gray-800 { background-color: #1f2937; }
        .bg-gray-900 { background-color: #111827; }
        .bg-white { background-color: #ffffff; }
        .bg-blue-50 { background-color: #eff6ff; }
        .bg-blue-600 { background-color: #2563eb; }
        .bg-blue-700 { background-color: #1d4ed8; }
        .bg-green-50 { background-color: #f0fdf4; }
        .bg-green-600 { background-color: #16a34a; }
        .bg-red-50 { background-color: #fef2f2; }
        .bg-red-600 { background-color: #dc2626; }
        
        .text-white { color: #ffffff; }
        .text-gray-300 { color: #d1d5db; }
        .text-gray-600 { color: #4b5563; }
        .text-gray-700 { color: #374151; }
        .text-gray-900 { color: #111827; }
        .text-blue-600 { color: #2563eb; }
        .text-blue-700 { color: #1d4ed8; }
        .text-green-600 { color: #16a34a; }
        .text-green-700 { color: #15803d; }
        .text-red-600 { color: #dc2626; }
        .text-red-700 { color: #b91c1c; }
        
        .border { border: 1px solid #e5e7eb; }
        .border-gray-300 { border-color: #d1d5db; }
        .border-gray-600 { border-color: #4b5563; }
        .border-gray-700 { border-color: #374151; }
        .border-blue-500 { border-color: #3b82f6; }
        .border-green-500 { border-color: #10b981; }
        .border-red-500 { border-color: #ef4444; }
        
        .rounded { border-radius: 0.25rem; }
        .rounded-lg { border-radius: 0.5rem; }
        .rounded-full { border-radius: 9999px; }
        
        .shadow-sm { box-shadow: 0 1px 2px 0 rgb(0 0 0 / 0.05); }
        .shadow-lg { box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -2px rgb(0 0 0 / 0.05); }
        
        .p-2 { padding: 0.5rem; }
        .p-3 { padding: 0.75rem; }
        .p-4 { padding: 1rem; }
        .p-6 { padding: 1.5rem; }
        .p-8 { padding: 2rem; }
        .px-2 { padding-left: 0.5rem; padding-right: 0.5rem; }
        .px-3 { padding-left: 0.75rem; padding-right: 0.75rem; }
        .px-4 { padding-left: 1rem; padding-right: 1rem; }
        .py-1 { padding-top: 0.25rem; padding-bottom: 0.25rem; }
        .py-2 { padding-top: 0.5rem; padding-bottom: 0.5rem; }
        .py-3 { padding-top: 0.75rem; padding-bottom: 0.75rem; }
        .pl-10 { padding-left: 2.5rem; }
        .pr-4 { padding-right: 1rem; }
        
        .m-2 { margin: 0.5rem; }
        .m-4 { margin: 1rem; }
        .mb-2 { margin-bottom: 0.5rem; }
        .mb-4 { margin-bottom: 1rem; }
        .mb-6 { margin-bottom: 1.5rem; }
        .mb-8 { margin-bottom: 2rem; }
        .mr-2 { margin-right: 0.5rem; }
        .mt-1 { margin-top: 0.25rem; }
        .mt-2 { margin-top: 0.5rem; }
        .mx-auto { margin-left: auto; margin-right: auto; }
        
        .w-4 { width: 1rem; }
        .w-5 { width: 1.25rem; }
        .w-6 { width: 1.5rem; }
        .w-8 { width: 2rem; }
        .w-12 { width: 3rem; }
        .w-full { width: 100%; }
        .max-w-4xl { max-width: 56rem; }
        .max-w-7xl { max-width: 80rem; }
        
        .h-2 { height: 0.5rem; }
        .h-4 { height: 1rem; }
        .h-5 { height: 1.25rem; }
        .h-6 { height: 1.5rem; }
        .h-8 { height: 2rem; }
        .h-12 { height: 3rem; }
        .min-h-screen { min-height: 100vh; }
        .max-h-32 { max-height: 8rem; }
        
        .flex { display: flex; }
        .grid { display: grid; }
        .hidden { display: none; }
        .block { display: block; }
        .inline-flex { display: inline-flex; }
        
        .flex-col { flex-direction: column; }
        .items-center { align-items: center; }
        .items-start { align-items: flex-start; }
        .justify-center { justify-content: center; }
        .justify-between { justify-content: space-between; }
        .gap-2 { gap: 0.5rem; }
        .gap-3 { gap: 0.75rem; }
        .gap-4 { gap: 1rem; }
        .gap-6 { gap: 1.5rem; }
        .space-y-2 > * + * { margin-top: 0.5rem; }
        .space-y-3 > * + * { margin-top: 0.75rem; }
        .space-y-4 > * + * { margin-top: 1rem; }
        
        .grid-cols-1 { grid-template-columns: repeat(1, minmax(0, 1fr)); }
        .grid-cols-2 { grid-template-columns: repeat(2, minmax(0, 1fr)); }
        
        .text-xs { font-size: 0.75rem; }
        .text-sm { font-size: 0.875rem; }
        .text-lg { font-size: 1.125rem; }
        .text-xl { font-size: 1.25rem; }
        .text-2xl { font-size: 1.5rem; }
        .text-3xl { font-size: 1.875rem; }
        .text-4xl { font-size: 2.25rem; }
        
        .font-medium { font-weight: 500; }
        .font-semibold { font-weight: 600; }
        .font-bold { font-weight: 700; }
        
        .text-center { text-align: center; }
        .text-left { text-align: left; }
        
        .cursor-pointer { cursor: pointer; }
        .select-none { user-select: none; }
        
        .overflow-hidden { overflow: hidden; }
        .overflow-y-auto { overflow-y: auto; }
        
        .relative { position: relative; }
        .absolute { position: absolute; }
        .fixed { position: fixed; }
        .top-4 { top: 1rem; }
        .right-4 { right: 1rem; }
        .left-3 { left: 0.75rem; }
        .top-1\/2 { top: 50%; }
        .z-50 { z-index: 50; }
        
        .transform { transform: translate(var(--tw-translate-x), var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y)); }
        .-translate-y-1\/2 { --tw-translate-y: -50%; transform: translate(var(--tw-translate-x), var(--tw-translate-y)); }
        
        .transition-colors { transition: color 0.3s, background-color 0.3s, border-color 0.3s; }
        .transition-shadow { transition: box-shadow 0.3s; }
        .transition-all { transition: all 0.3s; }
        
        .hover\:bg-gray-50:hover { background-color: #f9fafb; }
        .hover\:bg-gray-200:hover { background-color: #e5e7eb; }
        .hover\:bg-gray-600:hover { background-color: #4b5563; }
        .hover\:bg-gray-700:hover { background-color: #374151; }
        .hover\:bg-blue-700:hover { background-color: #1d4ed8; }
        .hover\:shadow-md:hover { box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -1px rgb(0 0 0 / 0.06); }
        
        .focus\:outline-none:focus { outline: none; }
        .focus\:ring-2:focus { box-shadow: 0 0 0 2px #3b82f6; }
        .focus\:ring-blue-500:focus { box-shadow: 0 0 0 2px #3b82f6; }
        
        .border-l-4 { border-left-width: 4px; }
        .border-dashed { border-style: dashed; }
        
        .file-upload-area {
            border: 2px dashed #cbd5e1;
            border-radius: 0.5rem;
            padding: 2rem;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .file-upload-area:hover {
            border-color: #3b82f6;
            background-color: #f8fafc;
        }
        .file-upload-area.drag-over {
            border-color: #3b82f6;
            background-color: #eff6ff;
        }
        
        .animate-spin {
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        .animate-slide-in {
            animation: slide-in 0.3s ease-out;
        }
        
        @keyframes slide-in {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        button {
            border: none;
            background: none;
            cursor: pointer;
            font: inherit;
        }
        
        input, select {
            font: inherit;
        }
        
        .btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-weight: 500;
            transition: all 0.3s;
            cursor: pointer;
        }
        
        .btn-primary {
            background-color: #2563eb;
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #1d4ed8;
        }
        
        .btn-secondary {
            background-color: #f3f4f6;
            color: #374151;
        }
        
        .btn-secondary:hover {
            background-color: #e5e7eb;
        }
        
        .dark {
            background-color: #111827;
            color: #f9fafb;
        }
        
        .dark .bg-white {
            background-color: #1f2937;
        }
        
        .dark .bg-gray-50 {
            background-color: #111827;
        }
        
        .dark .bg-gray-100 {
            background-color: #374151;
        }
        
        .dark .text-gray-600 {
            color: #9ca3af;
        }
        
        .dark .text-gray-700 {
            color: #d1d5db;
        }
        
        .dark .text-gray-900 {
            color: #f9fafb;
        }
        
        .dark .border-gray-300 {
            border-color: #4b5563;
        }
        
        .dark .file-upload-area {
            border-color: #475569;
            background-color: #1e293b;
        }
        
        .dark .file-upload-area:hover {
            border-color: #3b82f6;
            background-color: #334155;
        }
        
        @media (min-width: 768px) {
            .md\:grid-cols-2 { grid-template-columns: repeat(2, minmax(0, 1fr)); }
            .md\:grid-cols-4 { grid-template-columns: repeat(4, minmax(0, 1fr)); }
        }
        
        @media (min-width: 1024px) {
            .lg\:grid-cols-2 { grid-template-columns: repeat(2, minmax(0, 1fr)); }
            .lg\:grid-cols-4 { grid-template-columns: repeat(4, minmax(0, 1fr)); }
            .lg\:flex-row { flex-direction: row; }
            .lg\:items-center { align-items: center; }
            .lg\:justify-between { justify-content: space-between; }
        }
        
        @media (min-width: 1280px) {
            .xl\:grid-cols-6 { grid-template-columns: repeat(6, minmax(0, 1fr)); }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script>
        const { useState, useEffect, useMemo, useCallback, useRef, createElement: e } = React;
        const { render } = ReactDOM;
        
        // Fallback chart components if Recharts fails
        const SimpleBarChart = ({ data, dataKey, nameKey, color = '#3b82f6', height = 300 }) => {
            if (!data || data.length === 0) return e('div', { className: 'text-center py-8 text-gray-500' }, 'Geen data beschikbaar');
            
            const maxValue = Math.max(...data.map(d => d[dataKey]));
            
            return e('div', { className: 'space-y-2', style: { height: `${height}px`, overflowY: 'auto' } },
                data.map((item, index) => 
                    e('div', { key: index, className: 'flex items-center gap-3' }, [
                        e('div', { 
                            key: 'label', 
                            className: 'text-sm font-medium w-32 truncate', 
                            title: item[nameKey] 
                        }, item[nameKey]),
                        e('div', { key: 'bar-container', className: 'flex-1 bg-gray-200 rounded-full h-6 flex items-center' }, [
                            e('div', {
                                key: 'bar',
                                className: 'h-4 rounded-full transition-all duration-500',
                                style: { 
                                    width: `${(item[dataKey] / maxValue) * 100}%`,
                                    backgroundColor: color
                                }
                            }),
                            e('span', { 
                                key: 'value', 
                                className: 'ml-2 text-xs font-medium text-gray-600' 
                            }, item[dataKey].toLocaleString())
                        ])
                    ])
                )
            );
        };

        const SimplePieChart = ({ data, dataKey, nameKey, colors = ['#3b82f6', '#ef4444', '#10b981', '#f59e0b'] }) => {
            if (!data || data.length === 0) return e('div', { className: 'text-center py-8 text-gray-500' }, 'Geen data beschikbaar');
            
            const total = data.reduce((sum, item) => sum + item[dataKey], 0);
            
            return e('div', { className: 'space-y-4' }, [
                // Visual pie representation
                e('div', { key: 'visual', className: 'flex rounded-full overflow-hidden h-8 bg-gray-200 shadow-inner' },
                    data.map((item, index) => {
                        const percentage = (item[dataKey] / total) * 100;
                        return e('div', {
                            key: index,
                            className: 'transition-all duration-700 hover:brightness-110',
                            style: { 
                                width: `${percentage}%`,
                                backgroundColor: colors[index % colors.length]
                            },
                            title: `${item[nameKey]}: ${item[dataKey].toLocaleString()} (${percentage.toFixed(1)}%)`
                        });
                    })
                ),
                
                // Legend
                e('div', { key: 'legend', className: 'grid grid-cols-1 gap-3' },
                    data.map((item, index) => {
                        const percentage = ((item[dataKey] / total) * 100).toFixed(1);
                        return e('div', { key: index, className: 'flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors' }, [
                            e('div', { key: 'info', className: 'flex items-center gap-3' }, [
                                e('div', { 
                                    key: 'color', 
                                    className: 'w-4 h-4 rounded-full shadow-sm',
                                    style: { backgroundColor: colors[index % colors.length] }
                                }),
                                e('span', { key: 'name', className: 'text-sm font-medium text-gray-700' }, item[nameKey])
                            ]),
                            e('div', { key: 'stats', className: 'text-right' }, [
                                e('div', { key: 'value', className: 'text-sm font-bold text-gray-900' }, item[dataKey].toLocaleString()),
                                e('div', { key: 'percentage', className: 'text-xs text-gray-500' }, `${percentage}%`)
                            ])
                        ]);
                    })
                ),
                
                // Summary
                e('div', { key: 'summary', className: 'text-center text-sm text-gray-600 bg-blue-50 rounded p-2' },
                    `Totaal: ${total.toLocaleString()} requests verdeeld over ${data.length} environments`
                )
            ]);
        };

        const SimpleAreaChart = ({ data, dataKey, nameKey, color = '#3b82f6', height = 300 }) => {
            if (!data || data.length === 0) return e('div', { className: 'text-center py-8 text-gray-500' }, 'Geen data beschikbaar');
            
            const maxValue = Math.max(...data.map(d => d[dataKey]));
            const minValue = Math.min(...data.map(d => d[dataKey]));
            const range = maxValue - minValue;
            
            return e('div', { className: 'space-y-4' }, [
                e('div', { key: 'chart', className: 'relative bg-gray-50 rounded-lg p-4 overflow-x-auto', style: { height: `${height}px` } }, [
                    // Y-axis labels
                    e('div', { key: 'y-axis', className: 'absolute left-0 top-4 bottom-8 w-16 flex flex-col justify-between text-xs text-gray-600' }, [
                        e('span', { key: 'max' }, maxValue.toLocaleString()),
                        e('span', { key: 'mid' }, Math.round((maxValue + minValue) / 2).toLocaleString()),
                        e('span', { key: 'min' }, minValue.toLocaleString())
                    ]),
                    
                    // Chart area
                    e('div', { key: 'chart-area', className: 'ml-16 h-full flex items-end', style: { minWidth: `${data.length * 60}px` } },
                        data.map((item, index) => {
                            const heightPercent = range > 0 ? ((item[dataKey] - minValue) / range) * 80 + 10 : 50;
                            return e('div', { key: index, className: 'flex-1 flex flex-col items-center gap-2 px-1' }, [
                                e('div', { key: 'value', className: 'text-xs font-medium text-gray-700 mb-1' }, 
                                    item[dataKey].toLocaleString()
                                ),
                                e('div', {
                                    key: 'bar',
                                    className: 'w-8 transition-all duration-500 rounded-t-sm opacity-80 hover:opacity-100',
                                    style: { 
                                        height: `${heightPercent}%`,
                                        backgroundColor: color,
                                        minHeight: '4px'
                                    },
                                    title: `${item[nameKey]}: ${item[dataKey].toLocaleString()}`
                                }),
                                e('div', { 
                                    key: 'label', 
                                    className: 'text-xs text-gray-600 text-center leading-tight mt-2',
                                    style: { 
                                        writingMode: 'vertical-rl', 
                                        textOrientation: 'mixed',
                                        height: '40px',
                                        fontSize: '10px'
                                    }
                                }, item[nameKey])
                            ]);
                        })
                    )
                ]),
                e('div', { key: 'summary', className: 'text-center text-sm text-gray-600 bg-gray-100 rounded p-2' },
                    `Totaal: ${data.reduce((sum, d) => sum + d[dataKey], 0).toLocaleString()} requests over ${data.length} periodes`
                )
            ]);
        };

        // Icon Components
        const Upload = ({ className }) => e('svg', {
            className,
            xmlns: "http://www.w3.org/2000/svg",
            width: "24", height: "24", viewBox: "0 0 24 24",
            fill: "none", stroke: "currentColor", strokeWidth: "2",
            strokeLinecap: "round", strokeLinejoin: "round"
        }, [
            e('path', { key: 1, d: "M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" }),
            e('polyline', { key: 2, points: "17,8 12,3 7,8" }),
            e('line', { key: 3, x1: "12", x2: "12", y1: "3", y2: "15" })
        ]);

        const RefreshCw = ({ className }) => e('svg', {
            className,
            xmlns: "http://www.w3.org/2000/svg",
            width: "24", height: "24", viewBox: "0 0 24 24",
            fill: "none", stroke: "currentColor", strokeWidth: "2",
            strokeLinecap: "round", strokeLinejoin: "round"
        }, [
            e('path', { key: 1, d: "M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8" }),
            e('path', { key: 2, d: "M21 3v5h-5" }),
            e('path', { key: 3, d: "M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16" }),
            e('path', { key: 4, d: "M8 16H3v5" })
        ]);

        const AlertTriangle = ({ className }) => e('svg', {
            className,
            xmlns: "http://www.w3.org/2000/svg",
            width: "24", height: "24", viewBox: "0 0 24 24",
            fill: "none", stroke: "currentColor", strokeWidth: "2",
            strokeLinecap: "round", strokeLinejoin: "round"
        }, [
            e('path', { key: 1, d: "m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z" }),
            e('path', { key: 2, d: "M12 9v4" }),
            e('path', { key: 3, d: "m12 17 .01 0" })
        ]);

        const Download = ({ className }) => e('svg', {
            className,
            xmlns: "http://www.w3.org/2000/svg",
            width: "24", height: "24", viewBox: "0 0 24 24",
            fill: "none", stroke: "currentColor", strokeWidth: "2",
            strokeLinecap: "round", strokeLinejoin: "round"
        }, [
            e('path', { key: 1, d: "M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" }),
            e('polyline', { key: 2, points: "7,10 12,15 17,10" }),
            e('line', { key: 3, x1: "12", x2: "12", y1: "15", y2: "3" })
        ]);

        const Search = ({ className }) => e('svg', {
            className,
            xmlns: "http://www.w3.org/2000/svg",
            width: "24", height: "24", viewBox: "0 0 24 24",
            fill: "none", stroke: "currentColor", strokeWidth: "2",
            strokeLinecap: "round", strokeLinejoin: "round"
        }, [
            e('circle', { key: 1, cx: "11", cy: "11", r: "8" }),
            e('path', { key: 2, d: "m21 21-4.35-4.35" })
        ]);

        const Filter = ({ className }) => e('svg', {
            className,
            xmlns: "http://www.w3.org/2000/svg",
            width: "24", height: "24", viewBox: "0 0 24 24",
            fill: "none", stroke: "currentColor", strokeWidth: "2",
            strokeLinecap: "round", strokeLinejoin: "round"
        }, [
            e('polygon', { key: 1, points: "22,3 2,3 10,12.46 10,19 14,21 14,12.46" })
        ]);

        const TrendingUp = ({ className }) => e('svg', {
            className,
            xmlns: "http://www.w3.org/2000/svg",
            width: "24", height: "24", viewBox: "0 0 24 24",
            fill: "none", stroke: "currentColor", strokeWidth: "2",
            strokeLinecab: "round", strokeLinejoin: "round"
        }, [
            e('polyline', { key: 1, points: "22,7 13.5,15.5 8.5,10.5 2,17" }),
            e('polyline', { key: 2, points: "16,7 22,7 22,13" })
        ]);

        const Users = ({ className }) => e('svg', {
            className,
            xmlns: "http://www.w3.org/2000/svg",
            width: "24", height: "24", viewBox: "0 0 24 24",
            fill: "none", stroke: "currentColor", strokeWidth: "2",
            strokeLinecap: "round", strokeLinejoin: "round"
        }, [
            e('path', { key: 1, d: "M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2" }),
            e('circle', { key: 2, cx: "9", cy: "7", r: "4" }),
            e('path', { key: 3, d: "m22 21-1.5-1.5" })
        ]);

        const Package = ({ className }) => e('svg', {
            className,
            xmlns: "http://www.w3.org/2000/svg",
            width: "24", height: "24", viewBox: "0 0 24 24",
            fill: "none", stroke: "currentColor", strokeWidth: "2",
            strokeLinecap: "round", strokeLinejoin: "round"
        }, [
            e('path', { key: 1, d: "m7.5 4.27 9 5.15" }),
            e('path', { key: 2, d: "M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z" }),
            e('path', { key: 3, d: "m3.3 7 8.7 5 8.7-5" }),
            e('path', { key: 4, d: "M12 22V12" })
        ]);

        const Database = ({ className }) => e('svg', {
            className,
            xmlns: "http://www.w3.org/2000/svg",
            width: "24", height: "24", viewBox: "0 0 24 24",
            fill: "none", stroke: "currentColor", strokeWidth: "2",
            strokeLinecap: "round", strokeLinejoin: "round"
        }, [
            e('ellipse', { key: 1, cx: "12", cy: "5", rx: "9", ry: "3" }),
            e('path', { key: 2, d: "M3 5v14c0 1.66 4.03 3 9 3s9-1.34 9-3V5" }),
            e('path', { key: 3, d: "M3 12c0 1.66 4.03 3 9 3s9-1.34 9-3" })
        ]);

        const Calendar = ({ className }) => e('svg', {
            className,
            xmlns: "http://www.w3.org/2000/svg",
            width: "24", height: "24", viewBox: "0 0 24 24",
            fill: "none", stroke: "currentColor", strokeWidth: "2",
            strokeLinecap: "round", strokeLinejoin: "round"
        }, [
            e('path', { key: 1, d: "M8 2v4" }),
            e('path', { key: 2, d: "M16 2v4" }),
            e('rect', { key: 3, width: "18", height: "18", x: "3", y: "4", rx: "2" }),
            e('path', { key: 4, d: "M3 10h18" })
        ]);

        const Eye = ({ className }) => e('svg', {
            className,
            xmlns: "http://www.w3.org/2000/svg",
            width: "24", height: "24", viewBox: "0 0 24 24",
            fill: "none", stroke: "currentColor", strokeWidth: "2",
            strokeLinecap: "round", strokeLinejoin: "round"
        }, [
            e('path', { key: 1, d: "M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z" }),
            e('circle', { key: 2, cx: "12", cy: "12", r: "3" })
        ]);

        const Sun = ({ className }) => e('svg', {
            className,
            xmlns: "http://www.w3.org/2000/svg",
            width: "24", height: "24", viewBox: "0 0 24 24",
            fill: "none", stroke: "currentColor", strokeWidth: "2",
            strokeLinecap: "round", strokeLinejoin: "round"
        }, [
            e('circle', { key: 1, cx: "12", cy: "12", r: "4" }),
            e('path', { key: 2, d: "M12 2v2" }),
            e('path', { key: 3, d: "M12 20v2" }),
            e('path', { key: 4, d: "m4.93 4.93 1.41 1.41" }),
            e('path', { key: 5, d: "m17.66 17.66 1.41 1.41" }),
            e('path', { key: 6, d: "M2 12h2" }),
            e('path', { key: 7, d: "M20 12h2" }),
            e('path', { key: 8, d: "m6.34 17.66-1.41 1.41" }),
            e('path', { key: 9, d: "m19.07 4.93-1.41 1.41" })
        ]);

        const Moon = ({ className }) => e('svg', {
            className,
            xmlns: "http://www.w3.org/2000/svg",
            width: "24", height: "24", viewBox: "0 0 24 24",
            fill: "none", stroke: "currentColor", strokeWidth: "2",
            strokeLinecap: "round", strokeLinejoin: "round"
        }, [
            e('path', { key: 1, d: "M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z" })
        ]);

        const ChevronDown = ({ className }) => e('svg', {
            className,
            xmlns: "http://www.w3.org/2000/svg",
            width: "24", height: "24", viewBox: "0 0 24 24",
            fill: "none", stroke: "currentColor", strokeWidth: "2",
            strokeLinecap: "round", strokeLinejoin: "round"
        }, [
            e('path', { key: 1, d: "m6 9 6 6 6-6" })
        ]);

        // Main Component
        const IpcAnalysisTool = () => {
            const [data, setData] = useState([]);
            const [filteredData, setFilteredData] = useState([]);
            const [loading, setLoading] = useState(false);
            const [darkMode, setDarkMode] = useState(false);
            const [fileUploaded, setFileUploaded] = useState(false);
            const [uploadError, setUploadError] = useState(null);
            const [notifications, setNotifications] = useState([]);
            const [filters, setFilters] = useState({
                environment: [],
                insurer: [],
                product: [],
                user: [],
                dateRange: 'all',
                searchTerm: ''
            });
            const [uniqueValues, setUniqueValues] = useState({
                environments: [],
                insurers: [],
                products: [],
                users: []
            });

            const fileInputRef = useRef(null);

            // Helper functions
            const categorizeUser = (user, aantal) => {
                if (!user || user === 'NULL') return 'Unknown';
                if (aantal > 10000) return 'Enterprise';
                if (aantal > 1000) return 'Large';
                if (aantal > 100) return 'Medium';
                return 'Small';
            };

            const categorizeProduct = (product) => {
                if (!product) return 'Unknown';
                if (product.toLowerCase().includes('auto')) return 'Auto';
                if (product.toLowerCase().includes('woning')) return 'Property';
                if (product.toLowerCase().includes('aansprakelijk')) return 'Liability';
                return 'Other';
            };

            const calculateCompleteness = (row) => {
                const fields = ['Environment', 'YyyyMm', 'Engine', 'Insurer', 'Product', 'Gebruiker', 'Aantal'];
                const validFields = fields.filter(field => row[field] && row[field] !== 'NULL' && row[field] !== null);
                return (validFields.length / fields.length) * 100;
            };

            // File upload handler
            const handleFileUpload = async (file) => {
                if (!file) return;

                try {
                    setLoading(true);
                    setUploadError(null);
                    
                    const arrayBuffer = await file.arrayBuffer();
                    const workbook = XLSX.read(arrayBuffer, {
                        cellStyles: true,
                        cellFormulas: true,
                        cellDates: true,
                        cellNF: true,
                        sheetStubs: true
                    });

                    if (!workbook.SheetNames.includes('Data')) {
                        throw new Error('Excel bestand moet een "Data" sheet bevatten');
                    }

                    const dataSheet = workbook.Sheets['Data'];
                    const rawData = XLSX.utils.sheet_to_json(dataSheet);
                    
                    if (rawData.length === 0) {
                        throw new Error('Data sheet is leeg');
                    }

                    const processedData = rawData.map((row, index) => {
                        const date = row.YyyyMm ? new Date(row.YyyyMm) : null;
                        const monthNames = ['Jan', 'Feb', 'Mrt', 'Apr', 'Mei', 'Jun', 'Jul', 'Aug', 'Sep', 'Okt', 'Nov', 'Dec'];
                        
                        // Determine actual user - use GebruikerVe if available and valid, otherwise fall back to Gebruiker
                        const actualUser = (row.GebruikerVe && row.GebruikerVe !== '(geen VE_MYAAND)' && row.GebruikerVe.trim() !== '') 
                            ? row.GebruikerVe 
                            : row.Gebruiker;
                        
                        return {
                            ...row,
                            id: index,
                            YyyyMm: date,
                            Aantal: parseInt(row.Aantal) || 0,
                            month: date ? `${monthNames[date.getMonth()]} ${date.getFullYear()}` : 'Onbekend',
                            monthKey: date ? `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}` : 'unknown',
                            year: date ? date.getFullYear() : 'Onbekend',
                            actualUser: actualUser,
                            userCategory: categorizeUser(actualUser, row.Aantal),
                            productCategory: categorizeProduct(row.Product),
                            hasValidDate: !!date,
                            hasValidUser: !!actualUser && actualUser !== 'NULL',
                            completeness: calculateCompleteness(row)
                        };
                    });

                    setData(processedData);
                    setFilteredData(processedData);

                    setUniqueValues({
                        environments: _.uniq(processedData.map(d => d.Environment)).filter(Boolean),
                        insurers: _.uniq(processedData.map(d => d.Insurer)).filter(Boolean).sort(),
                        products: _.uniq(processedData.map(d => d.Product)).filter(Boolean).sort(),
                        users: _.uniq(processedData.map(d => d.actualUser)).filter(d => d && d !== 'NULL').sort()
                    });

                    setFileUploaded(true);
                    addNotification('success', `${processedData.length.toLocaleString()} records succesvol geladen`);
                    
                } catch (error) {
                    console.error('Error loading data:', error);
                    setUploadError(error.message);
                    addNotification('error', `Fout bij laden: ${error.message}`);
                } finally {
                    setLoading(false);
                }
            };

            // Notification system
            const addNotification = (type, message) => {
                const id = Date.now();
                setNotifications(prev => [...prev, { id, type, message, timestamp: new Date() }]);
                setTimeout(() => {
                    setNotifications(prev => prev.filter(n => n.id !== id));
                }, 5000);
            };

            // Apply filters
            const applyFilters = useCallback(() => {
                let filtered = [...data];

                if (filters.environment.length > 0) {
                    filtered = filtered.filter(d => filters.environment.includes(d.Environment));
                }
                if (filters.insurer.length > 0) {
                    filtered = filtered.filter(d => filters.insurer.includes(d.Insurer));
                }
                if (filters.product.length > 0) {
                    filtered = filtered.filter(d => filters.product.includes(d.Product));
                }
                if (filters.user.length > 0) {
                    filtered = filtered.filter(d => filters.user.includes(d.actualUser));
                }

                if (filters.dateRange !== 'all') {
                    const now = new Date();
                    const cutoff = new Date();
                    switch (filters.dateRange) {
                        case '1year':
                            cutoff.setFullYear(now.getFullYear() - 1);
                            break;
                        case '6months':
                            cutoff.setMonth(now.getMonth() - 6);
                            break;
                        case '3months':
                            cutoff.setMonth(now.getMonth() - 3);
                            break;
                        case '1month':
                            cutoff.setMonth(now.getMonth() - 1);
                            break;
                    }
                    filtered = filtered.filter(d => d.YyyyMm && d.YyyyMm >= cutoff);
                }

                if (filters.searchTerm) {
                    const searchLower = filters.searchTerm.toLowerCase();
                    filtered = filtered.filter(d => 
                        (d.Insurer && d.Insurer.toLowerCase().includes(searchLower)) ||
                        (d.Product && d.Product.toLowerCase().includes(searchLower)) ||
                        (d.actualUser && d.actualUser.toLowerCase().includes(searchLower)) ||
                        (d.Engine && d.Engine.toLowerCase().includes(searchLower))
                    );
                }

                setFilteredData(filtered);
            }, [data, filters]);

            useEffect(() => {
                applyFilters();
            }, [applyFilters]);

            // Statistics
            const stats = useMemo(() => {
                const totalRequests = filteredData.reduce((sum, d) => sum + d.Aantal, 0);
                const uniqueUsers = _.uniq(filteredData.map(d => d.actualUser)).length;
                const uniqueProducts = _.uniq(filteredData.map(d => d.Product)).length;
                const uniqueInsurers = _.uniq(filteredData.map(d => d.Insurer)).length;
                const avgPerMonth = filteredData.length > 0 ? Math.round(totalRequests / _.uniq(filteredData.map(d => d.month)).length) : 0;
                const dataQuality = _.mean(filteredData.map(d => d.completeness)) || 0;

                return {
                    totalRequests,
                    uniqueUsers,
                    uniqueProducts,
                    uniqueInsurers,
                    avgPerMonth,
                    totalRecords: filteredData.length,
                    dataQuality
                };
            }, [filteredData]);

            // Chart data
            const getMonthlyData = () => {
                const grouped = _.groupBy(filteredData.filter(d => d.YyyyMm), d => {
                    const date = new Date(d.YyyyMm);
                    return `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;
                });
                
                return Object.entries(grouped)
                    .map(([monthKey, records]) => {
                        const [year, month] = monthKey.split('-');
                        const monthNames = ['Jan', 'Feb', 'Mrt', 'Apr', 'Mei', 'Jun', 'Jul', 'Aug', 'Sep', 'Okt', 'Nov', 'Dec'];
                        const monthName = monthNames[parseInt(month) - 1];
                        
                        return {
                            month: `${monthName} ${year}`,
                            monthKey: monthKey,
                            requests: records.reduce((sum, r) => sum + r.Aantal, 0),
                            records: records.length,
                            sortDate: new Date(parseInt(year), parseInt(month) - 1, 1)
                        };
                    })
                    .sort((a, b) => a.sortDate - b.sortDate)
                    .slice(-12); // Laatste 12 maanden
            };

            const getInsurerData = () => {
                const grouped = _.groupBy(filteredData, 'Insurer');
                return Object.entries(grouped)
                    .map(([insurer, records]) => ({
                        insurer,
                        requests: records.reduce((sum, r) => sum + r.Aantal, 0)
                    }))
                    .sort((a, b) => b.requests - a.requests)
                    .slice(0, 10);
            };

            const getProductData = () => {
                const grouped = _.groupBy(filteredData, 'Product');
                return Object.entries(grouped)
                    .map(([product, records]) => ({
                        product: product.length > 25 ? product.substring(0, 25) + '...' : product,
                        fullProduct: product,
                        requests: records.reduce((sum, r) => sum + r.Aantal, 0)
                    }))
                    .sort((a, b) => b.requests - a.requests)
                    .slice(0, 10);
            };

            const getEnvironmentData = () => {
                const grouped = _.groupBy(filteredData, 'Environment');
                return Object.entries(grouped)
                    .map(([env, records]) => ({
                        environment: env,
                        requests: records.reduce((sum, r) => sum + r.Aantal, 0),
                        share: (records.reduce((sum, r) => sum + r.Aantal, 0) / filteredData.reduce((sum, r) => sum + r.Aantal, 0)) * 100
                    }));
            };

            const handleMultiSelectFilter = (type, value) => {
                setFilters(prev => ({
                    ...prev,
                    [type]: prev[type].includes(value) 
                        ? prev[type].filter(v => v !== value)
                        : [...prev[type], value]
                }));
            };

            const exportData = (format) => {
                const timestamp = new Date().toISOString().split('T')[0];
                
                if (format === 'excel') {
                    const wb = XLSX.utils.book_new();
                    const ws = XLSX.utils.json_to_sheet(filteredData);
                    XLSX.utils.book_append_sheet(wb, ws, 'Filtered Data');
                    XLSX.writeFile(wb, `ipc-analysis-${timestamp}.xlsx`);
                } else if (format === 'csv') {
                    const csv = [
                        Object.keys(filteredData[0] || {}).join(','),
                        ...filteredData.map(row => Object.values(row).join(','))
                    ].join('\n');
                    const blob = new Blob([csv], { type: 'text/csv' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `ipc-analysis-${timestamp}.csv`;
                    a.click();
                }
                addNotification('success', `Data geÃ«xporteerd als ${format.toUpperCase()}`);
            };

            const colors = ['#3b82f6', '#ef4444', '#10b981', '#f59e0b', '#8b5cf6', '#ec4899'];

            // File upload component
            const FileUploadArea = () => {
                const [dragOver, setDragOver] = useState(false);

                const handleDrop = (event) => {
                    event.preventDefault();
                    setDragOver(false);
                    const files = event.dataTransfer.files;
                    if (files.length > 0) {
                        handleFileUpload(files[0]);
                    }
                };

                const handleDragOver = (event) => {
                    event.preventDefault();
                    setDragOver(true);
                };

                const handleDragLeave = (event) => {
                    event.preventDefault();
                    setDragOver(false);
                };

                return e('div', 
                    {
                        className: `file-upload-area ${dragOver ? 'drag-over' : ''}`,
                        onDrop: handleDrop,
                        onDragOver: handleDragOver,
                        onDragLeave: handleDragLeave,
                        onClick: () => fileInputRef.current?.click()
                    },
                    e('div', { className: 'flex flex-col items-center gap-4' }, [
                        e(Upload, { key: 'icon', className: 'w-12 h-12 text-gray-400' }),
                        e('div', { key: 'text', className: 'text-center' }, [
                            e('p', { key: 'title', className: 'text-lg font-medium text-gray-700' }, 'Upload IPC Data Excel Bestand'),
                            e('p', { key: 'subtitle', className: 'text-sm text-gray-600 mt-1' }, 'Sleep het bestand hierheen of klik om te selecteren'),
                            e('p', { key: 'requirement', className: 'text-xs text-gray-400 mt-2' }, 'Excel bestand moet een "Data" sheet bevatten')
                        ]),
                        e('input', {
                            key: 'input',
                            ref: fileInputRef,
                            type: 'file',
                            accept: '.xlsx,.xls',
                            onChange: (event) => {
                                if (event.target.files.length > 0) {
                                    handleFileUpload(event.target.files[0]);
                                }
                            },
                            className: 'hidden'
                        })
                    ])
                );
            };

            useEffect(() => {
                if (darkMode) {
                    document.body.classList.add('dark');
                } else {
                    document.body.classList.remove('dark');
                }
            }, [darkMode]);

            if (!fileUploaded) {
                return e('div', 
                    { className: `min-h-screen transition-colors ${darkMode ? 'bg-gray-900 text-white' : 'bg-gray-50 text-gray-900'} p-6` },
                    [
                        // Notifications
                        e('div', { key: 'notifications', className: 'fixed top-4 right-4 z-50 space-y-2' },
                            notifications.map(notification =>
                                e('div',
                                    {
                                        key: notification.id,
                                        className: `p-3 rounded-lg shadow-lg border-l-4 animate-slide-in ${
                                            notification.type === 'error' ? 'bg-red-50 border-red-500 text-red-700' :
                                            notification.type === 'success' ? 'bg-green-50 border-green-500 text-green-700' :
                                            'bg-blue-50 border-blue-500 text-blue-700'
                                        }`
                                    },
                                    e('span', { className: 'text-sm font-medium' }, notification.message)
                                )
                            )
                        ),
                        
                        e('div', { key: 'main', className: 'max-w-4xl mx-auto' }, [
                            // Header
                            e('div', 
                                { key: 'header', className: `${darkMode ? 'bg-gray-800' : 'bg-white'} rounded-lg shadow-sm p-8 mb-8 text-center` },
                                [
                                    e('h1', 
                                        { key: 'title', className: 'text-4xl font-bold mb-4 text-blue-600' },
                                        'IPC Requests Analyse Dashboard'
                                    ),
                                    e('p', 
                                        { key: 'subtitle', className: `${darkMode ? 'text-gray-300' : 'text-gray-600'} text-xl mb-6` },
                                        'Upload je Excel bestand om geavanceerde analyses te starten'
                                    ),
                                    e('div', { key: 'actions', className: 'flex justify-center gap-4' }, [
                                        e('button',
                                            {
                                                key: 'dark-toggle',
                                                onClick: () => setDarkMode(!darkMode),
                                                className: `p-3 rounded-lg ${darkMode ? 'bg-gray-700 hover:bg-gray-600' : 'bg-gray-100 hover:bg-gray-200'} transition-colors`
                                            },
                                            darkMode ? e(Sun, { className: 'w-6 h-6' }) : e(Moon, { className: 'w-6 h-6' })
                                        )
                                    ])
                                ]
                            ),

                            // Upload Area
                            e('div', 
                                { key: 'upload', className: `${darkMode ? 'bg-gray-800' : 'bg-white'} rounded-lg shadow-sm p-8 mb-8` },
                                loading ? 
                                    e('div', { key: 'loading', className: 'text-center py-12' }, [
                                        e(RefreshCw, { key: 'spinner', className: 'w-12 h-12 animate-spin mx-auto mb-4 text-blue-600' }),
                                        e('p', { key: 'text', className: 'text-lg' }, 'Bestand wordt verwerkt...')
                                    ])
                                    :
                                    e(FileUploadArea, { key: 'upload-area' })
                            ),

                            // Error Display
                            uploadError && e('div', 
                                { key: 'error', className: 'bg-red-50 border border-red-200 rounded-lg p-6 mb-8' },
                                e('div', { className: 'flex items-center gap-3' }, [
                                    e(AlertTriangle, { key: 'icon', className: 'w-6 h-6 text-red-600' }),
                                    e('div', { key: 'text' }, [
                                        e('h3', { key: 'title', className: 'font-medium text-red-800' }, 'Upload Fout'),
                                        e('p', { key: 'message', className: 'text-red-600 mt-1' }, uploadError)
                                    ])
                                ])
                            )
                        ])
                    ]
                );
            }

            return e('div', 
                { className: `min-h-screen transition-colors ${darkMode ? 'bg-gray-900 text-white' : 'bg-gray-50 text-gray-900'} p-6` },
                [
                    // Notifications
                    e('div', { key: 'notifications', className: 'fixed top-4 right-4 z-50 space-y-2' },
                        notifications.map(notification =>
                            e('div',
                                {
                                    key: notification.id,
                                    className: `p-3 rounded-lg shadow-lg border-l-4 animate-slide-in ${
                                        notification.type === 'error' ? 'bg-red-50 border-red-500 text-red-700' :
                                        notification.type === 'success' ? 'bg-green-50 border-green-500 text-green-700' :
                                        'bg-blue-50 border-blue-500 text-blue-700'
                                    }`
                                },
                                e('span', { className: 'text-sm font-medium' }, notification.message)
                            )
                        )
                    ),

                    e('div', { key: 'main', className: 'max-w-7xl mx-auto' }, [
                        // Header
                        e('div', 
                            { key: 'header', className: `${darkMode ? 'bg-gray-800' : 'bg-white'} rounded-lg shadow-sm p-6 mb-6` },
                            e('div', { className: 'flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4' }, [
                                e('div', { key: 'title-section' }, [
                                    e('h1', 
                                        { className: 'text-3xl font-bold mb-2 text-blue-600' },
                                        'IPC Requests Analyse Dashboard'
                                    ),
                                    e('p', 
                                        { className: `${darkMode ? 'text-gray-300' : 'text-gray-600'}` },
                                        `Analyseer ${data.length.toLocaleString()} records | Data kwaliteit: ${stats.dataQuality.toFixed(1)}%`
                                    )
                                ]),
                                e('div', { key: 'actions', className: 'flex items-center gap-3' }, [
                                    e('button',
                                        {
                                            onClick: () => setDarkMode(!darkMode),
                                            className: `p-2 rounded-lg ${darkMode ? 'bg-gray-700 hover:bg-gray-600' : 'bg-gray-100 hover:bg-gray-200'} transition-colors`
                                        },
                                        darkMode ? e(Sun, { className: 'w-5 h-5' }) : e(Moon, { className: 'w-5 h-5' })
                                    ),
                                    e('button', 
                                        { 
                                            onClick: () => exportData('excel'),
                                            className: `flex items-center gap-2 px-4 py-2 rounded-lg ${darkMode ? 'bg-gray-700 hover:bg-gray-600' : 'bg-blue-600 hover:bg-blue-700'} text-white transition-colors`
                                        },
                                        [
                                            e(Download, { key: 'icon', className: 'w-4 h-4' }),
                                            e('span', { key: 'text' }, 'Export Excel')
                                        ]
                                    )
                                ])
                            ])
                        ),

                        // Filters
                        e('div', 
                            { key: 'filters', className: `${darkMode ? 'bg-gray-800' : 'bg-white'} rounded-lg shadow-sm p-6 mb-6` },
                            [
                                e('div', { key: 'filter-header', className: 'flex items-center gap-2 mb-4' }, [
                                    e(Filter, { className: 'w-5 h-5 text-gray-600' }),
                                    e('h2', { className: 'text-lg font-semibold' }, 'Filters')
                                ]),
                                e('div', { key: 'filter-content', className: 'space-y-4' }, [
                                    // Search
                                    e('div', { className: 'relative' }, [
                                        e(Search, { className: 'absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400' }),
                                        e('input', {
                                            type: 'text',
                                            placeholder: 'Zoek in verzekeraars, producten, gebruikers...',
                                            value: filters.searchTerm,
                                            onChange: (event) => setFilters(prev => ({ ...prev, searchTerm: event.target.value })),
                                            className: `w-full pl-10 pr-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 ${
                                                darkMode ? 'bg-gray-700 border-gray-600 text-white' : 'bg-white border-gray-300'
                                            }`
                                        })
                                    ]),
                                    
                                    e('div', { className: 'grid grid-cols-1 lg:grid-cols-5 gap-4' }, [
                                        // Environment filter
                                        e('div', { key: 'env-filter' }, [
                                            e('label', { className: 'block text-sm font-medium mb-2' }, 'Environment'),
                                            e('div', 
                                                { className: `border rounded-lg p-2 max-h-32 overflow-y-auto ${darkMode ? 'border-gray-600 bg-gray-700' : 'border-gray-300 bg-white'}` },
                                                uniqueValues.environments.map(env =>
                                                    e('label', 
                                                        { 
                                                            key: env,
                                                            className: 'flex items-center gap-2 p-1 hover:bg-gray-50 rounded cursor-pointer' 
                                                        },
                                                        [
                                                            e('input', {
                                                                key: 'checkbox',
                                                                type: 'checkbox',
                                                                checked: filters.environment.includes(env),
                                                                onChange: () => handleMultiSelectFilter('environment', env),
                                                                className: 'w-4 h-4'
                                                            }),
                                                            e('span', { key: 'label', className: 'text-sm' }, env)
                                                        ]
                                                    )
                                                )
                                            )
                                        ]),

                                        // Insurer filter
                                        e('div', { key: 'insurer-filter' }, [
                                            e('label', { className: 'block text-sm font-medium mb-2' }, 'Verzekeraar'),
                                            e('div', 
                                                { className: `border rounded-lg p-2 max-h-32 overflow-y-auto ${darkMode ? 'border-gray-600 bg-gray-700' : 'border-gray-300 bg-white'}` },
                                                uniqueValues.insurers.slice(0, 15).map(insurer =>
                                                    e('label', 
                                                        { 
                                                            key: insurer,
                                                            className: 'flex items-center gap-2 p-1 hover:bg-gray-50 rounded cursor-pointer' 
                                                        },
                                                        [
                                                            e('input', {
                                                                key: 'checkbox',
                                                                type: 'checkbox',
                                                                checked: filters.insurer.includes(insurer),
                                                                onChange: () => handleMultiSelectFilter('insurer', insurer),
                                                                className: 'w-4 h-4'
                                                            }),
                                                            e('span', { key: 'label', className: 'text-sm', title: insurer }, 
                                                                insurer.length > 20 ? insurer.substring(0, 20) + '...' : insurer
                                                            )
                                                        ]
                                                    )
                                                )
                                            )
                                        ]),

                                        // Product filter
                                        e('div', { key: 'product-filter' }, [
                                            e('label', { className: 'block text-sm font-medium mb-2' }, 'Product'),
                                            e('div', 
                                                { className: `border rounded-lg p-2 max-h-32 overflow-y-auto ${darkMode ? 'border-gray-600 bg-gray-700' : 'border-gray-300 bg-white'}` },
                                                uniqueValues.products.slice(0, 15).map(product =>
                                                    e('label', 
                                                        { 
                                                            key: product,
                                                            className: 'flex items-center gap-2 p-1 hover:bg-gray-50 rounded cursor-pointer' 
                                                        },
                                                        [
                                                            e('input', {
                                                                key: 'checkbox',
                                                                type: 'checkbox',
                                                                checked: filters.product.includes(product),
                                                                onChange: () => handleMultiSelectFilter('product', product),
                                                                className: 'w-4 h-4'
                                                            }),
                                                            e('span', { key: 'label', className: 'text-sm', title: product }, 
                                                                product.length > 20 ? product.substring(0, 20) + '...' : product
                                                            )
                                                        ]
                                                    )
                                                )
                                            )
                                        ]),

                                        // User filter
                                        e('div', { key: 'user-filter' }, [
                                            e('label', { className: 'block text-sm font-medium mb-2' }, 'Gebruiker'),
                                            e('div', 
                                                { className: `border rounded-lg p-2 max-h-32 overflow-y-auto ${darkMode ? 'border-gray-600 bg-gray-700' : 'border-gray-300 bg-white'}` },
                                                uniqueValues.users.slice(0, 15).map(user =>
                                                    e('label', 
                                                        { 
                                                            key: user,
                                                            className: 'flex items-center gap-2 p-1 hover:bg-gray-50 rounded cursor-pointer' 
                                                        },
                                                        [
                                                            e('input', {
                                                                key: 'checkbox',
                                                                type: 'checkbox',
                                                                checked: filters.user.includes(user),
                                                                onChange: () => handleMultiSelectFilter('user', user),
                                                                className: 'w-4 h-4'
                                                            }),
                                                            e('span', { key: 'label', className: 'text-sm', title: user }, 
                                                                user.length > 20 ? user.substring(0, 20) + '...' : user
                                                            )
                                                        ]
                                                    )
                                                )
                                            )
                                        ]),

                                        // Date Range filter
                                        e('div', { key: 'date-filter' }, [
                                            e('label', { className: 'block text-sm font-medium mb-2' }, 'Periode'),
                                            e('select', {
                                                value: filters.dateRange,
                                                onChange: (event) => setFilters(prev => ({ ...prev, dateRange: event.target.value })),
                                                className: `w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 ${
                                                    darkMode ? 'bg-gray-700 border-gray-600 text-white' : 'bg-white border-gray-300'
                                                }`
                                            }, [
                                                e('option', { key: 'all', value: 'all' }, 'Alle periodes'),
                                                e('option', { key: '1month', value: '1month' }, 'Laatste maand'),
                                                e('option', { key: '3months', value: '3months' }, 'Laatste 3 maanden'),
                                                e('option', { key: '6months', value: '6months' }, 'Laatste 6 maanden'),
                                                e('option', { key: '1year', value: '1year' }, 'Laatste jaar')
                                            ])
                                        ])
                                    ])
                                ])
                            ]
                        ),

                        // Statistics Cards
                        e('div', 
                            { key: 'stats', className: 'grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 xl:grid-cols-6 gap-4 mb-6' },
                            [
                                {
                                    title: 'Totaal Requests',
                                    value: stats.totalRequests.toLocaleString(),
                                    icon: TrendingUp,
                                    color: 'blue'
                                },
                                {
                                    title: 'Unieke Gebruikers',
                                    value: stats.uniqueUsers.toLocaleString(),
                                    icon: Users,
                                    color: 'green'
                                },
                                {
                                    title: 'Producten',
                                    value: stats.uniqueProducts,
                                    icon: Package,
                                    color: 'purple'
                                },
                                {
                                    title: 'Verzekeraars',
                                    value: stats.uniqueInsurers,
                                    icon: Database,
                                    color: 'orange'
                                },
                                {
                                    title: 'Gem. per Maand',
                                    value: stats.avgPerMonth.toLocaleString(),
                                    icon: Calendar,
                                    color: 'pink'
                                },
                                {
                                    title: 'Data Kwaliteit',
                                    value: `${stats.dataQuality.toFixed(1)}%`,
                                    icon: Eye,
                                    color: 'cyan'
                                }
                            ].map((stat, index) =>
                                e('div', 
                                    { 
                                        key: index,
                                        className: `${darkMode ? 'bg-gray-800' : 'bg-white'} rounded-lg shadow-sm p-4 border-l-4 border-blue-500 hover:shadow-md transition-shadow`
                                    },
                                    e('div', { className: 'flex items-center justify-between' }, [
                                        e('div', { key: 'content' }, [
                                            e('p', 
                                                { className: `text-sm font-medium ${darkMode ? 'text-gray-400' : 'text-gray-600'}` },
                                                stat.title
                                            ),
                                            e('p', { className: 'text-2xl font-bold mt-1' }, stat.value)
                                        ]),
                                        e(stat.icon, { key: 'icon', className: 'w-8 h-8 text-blue-600' })
                                    ])
                                )
                            )
                        ),

                        // Charts
                        e('div', { key: 'charts', className: 'grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6' }, [
                            // Monthly Trend
                            e('div', 
                                { key: 'monthly', className: `${darkMode ? 'bg-gray-800' : 'bg-white'} rounded-lg shadow-sm p-6` },
                                [
                                    e('h3', { key: 'title', className: 'text-lg font-semibold mb-4' }, 'Maandelijkse Trend'),
                                    typeof Recharts !== 'undefined' ? 
                                        e(ResponsiveContainer, { key: 'chart', width: '100%', height: 300 },
                                            e(AreaChart, { data: getMonthlyData() }, [
                                                e(CartesianGrid, { key: 'grid', strokeDasharray: '3 3', stroke: darkMode ? '#374151' : '#e5e7eb' }),
                                                e(XAxis, { key: 'xaxis', dataKey: 'month', stroke: darkMode ? '#9ca3af' : '#6b7280' }),
                                                e(YAxis, { key: 'yaxis', stroke: darkMode ? '#9ca3af' : '#6b7280' }),
                                                e(Tooltip, { 
                                                    key: 'tooltip',
                                                    formatter: (value) => [value.toLocaleString(), 'Requests'],
                                                    contentStyle: {
                                                        backgroundColor: darkMode ? '#1f2937' : '#ffffff',
                                                        border: '1px solid ' + (darkMode ? '#374151' : '#e5e7eb'),
                                                        borderRadius: '0.5rem'
                                                    }
                                                }),
                                                e(Area, { 
                                                    key: 'area',
                                                    type: 'monotone', 
                                                    dataKey: 'requests', 
                                                    stroke: '#3b82f6', 
                                                    fill: '#3b82f6', 
                                                    fillOpacity: 0.6 
                                                })
                                            ])
                                        ) :
                                        e(SimpleAreaChart, { 
                                            key: 'fallback',
                                            data: getMonthlyData(), 
                                            dataKey: 'requests', 
                                            nameKey: 'month', 
                                            color: '#3b82f6' 
                                        })
                                ]
                            ),

                            // Environment Distribution
                            e('div', 
                                { key: 'environment', className: `${darkMode ? 'bg-gray-800' : 'bg-white'} rounded-lg shadow-sm p-6` },
                                [
                                    e('h3', { key: 'title', className: 'text-lg font-semibold mb-4' }, 'Environment Verdeling'),
                                    typeof Recharts !== 'undefined' ?
                                        e(ResponsiveContainer, { key: 'chart', width: '100%', height: 300 },
                                            e(PieChart, {}, [
                                                e(Pie, {
                                                    key: 'pie',
                                                    data: getEnvironmentData(),
                                                    cx: '50%',
                                                    cy: '50%',
                                                    labelLine: false,
                                                    label: ({ environment, share }) => `${environment} (${share.toFixed(1)}%)`,
                                                    outerRadius: 80,
                                                    fill: '#8884d8',
                                                    dataKey: 'requests'
                                                }, getEnvironmentData().map((entry, index) =>
                                                    e(Cell, { 
                                                        key: `cell-${index}`, 
                                                        fill: colors[index % colors.length] 
                                                    })
                                                )),
                                                e(Tooltip, { 
                                                    key: 'tooltip',
                                                    formatter: (value) => [value.toLocaleString(), 'Requests'],
                                                    contentStyle: {
                                                        backgroundColor: darkMode ? '#1f2937' : '#ffffff',
                                                        border: '1px solid ' + (darkMode ? '#374151' : '#e5e7eb'),
                                                        borderRadius: '0.5rem'
                                                    }
                                                })
                                            ])
                                        ) :
                                        e(SimplePieChart, { 
                                            key: 'fallback',
                                            data: getEnvironmentData(), 
                                            dataKey: 'requests', 
                                            nameKey: 'environment', 
                                            colors: colors 
                                        })
                                ]
                            )
                        ]),

                        // Top Performers - Updated to show different views based on filters
                        e('div', { key: 'performers', className: 'grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6' }, [
                            // Dynamic first chart - shows users if product is selected, otherwise insurers
                            e('div', 
                                { key: 'dynamic1', className: `${darkMode ? 'bg-gray-800' : 'bg-white'} rounded-lg shadow-sm p-6` },
                                [
                                    e('h3', { key: 'title', className: 'text-lg font-semibold mb-4' }, 
                                        filters.product.length > 0 ? 'Gebruikers van Geselecteerde Producten' : 'Top 10 Verzekeraars'
                                    ),
                                    typeof Recharts !== 'undefined' ? null :
                                        e(SimpleBarChart, { 
                                            key: 'fallback',
                                            data: filters.product.length > 0 ? getProductUserData() : getInsurerData(), 
                                            dataKey: 'requests', 
                                            nameKey: filters.product.length > 0 ? 'user' : 'insurer', 
                                            color: '#10b981' 
                                        })
                                ]
                            ),

                            // Dynamic second chart - shows products of selected users, or top users, or top products
                            e('div', 
                                { key: 'dynamic2', className: `${darkMode ? 'bg-gray-800' : 'bg-white'} rounded-lg shadow-sm p-6` },
                                [
                                    e('h3', { key: 'title', className: 'text-lg font-semibold mb-4' }, 
                                        filters.user.length > 0 ? 'Producten van Geselecteerde Gebruikers' :
                                        filters.product.length === 0 && filters.user.length === 0 ? 'Top 10 Gebruikers' :
                                        'Top 10 Producten'
                                    ),
                                    typeof Recharts !== 'undefined' ? null :
                                        e(SimpleBarChart, { 
                                            key: 'fallback',
                                            data: filters.user.length > 0 ? getUserProductData() :
                                                   filters.product.length === 0 && filters.user.length === 0 ? getUserData() :
                                                   getProductData(), 
                                            dataKey: 'requests', 
                                            nameKey: filters.user.length > 0 ? 'product' :
                                                    filters.product.length === 0 && filters.user.length === 0 ? 'user' :
                                                    'product', 
                                            color: '#f59e0b' 
                                        })
                                ]
                            )
                        ]),

                        // Footer
                        e('div', 
                            { key: 'footer', className: `${darkMode ? 'bg-gray-800' : 'bg-white'} rounded-lg shadow-sm p-6` },
                            e('div', { className: 'flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4' }, [
                                e('div', { key: 'actions', className: 'flex items-center gap-4' }, [
                                    e('button',
                                        {
                                            onClick: () => window.location.reload(),
                                            className: 'flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors'
                                        },
                                        [
                                            e(RefreshCw, { key: 'icon', className: 'w-4 h-4' }),
                                            e('span', { key: 'text' }, 'Vernieuw Data')
                                        ]
                                    )
                                ]),
                                
                                e('div', { key: 'info', className: 'flex items-center gap-4 text-sm text-gray-500' }, [
                                    e('span', { key: 'update' }, `Laatste update: ${new Date().toLocaleString('nl-NL')}`),
                                    e('span', { key: 'sep1' }, 'â¢'),
                                    e('span', { key: 'records' }, `${filteredData.length.toLocaleString()} van ${data.length.toLocaleString()} records`),
                                    e('span', { key: 'sep2' }, 'â¢'),
                                    e('span', { key: 'perf' }, `Geladen in ${(Date.now() / 1000).toFixed(1)}s`)
                                ])
                            ])
                        )
                    ])
                ]
            );
        };

        // Render the app
        render(e(IpcAnalysisTool), document.getElementById('root'));
    </script>
</body>
</html>
