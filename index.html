<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IPC Requests Analyse Dashboard</title>
    
    <!-- Core Libraries with fallbacks -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Fallback React from different CDN -->
    <script>
        if (typeof React === 'undefined') {
            console.log('Loading React from alternative CDN...');
            document.write('<script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.development.min.js"><\/script>');
            document.write('<script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.development.min.js"><\/script>');
        }
    </script>
    
    <!-- Data Processing Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.21/lodash.min.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            line-height: 1.6;
            color: #333;
        }
        
        .bg-gray-50 { background-color: #f9fafb; }
        .bg-gray-100 { background-color: #f3f4f6; }
        .bg-gray-200 { background-color: #e5e7eb; }
        .bg-gray-800 { background-color: #1f2937; }
        .bg-gray-900 { background-color: #111827; }
        .bg-white { background-color: #ffffff; }
        .bg-blue-50 { background-color: #eff6ff; }
        .bg-blue-600 { background-color: #2563eb; }
        .bg-blue-700 { background-color: #1d4ed8; }
        .bg-green-50 { background-color: #f0fdf4; }
        .bg-green-600 { background-color: #16a34a; }
        .bg-red-50 { background-color: #fef2f2; }
        .bg-red-600 { background-color: #dc2626; }
        .bg-yellow-50 { background-color: #fffbeb; }
        .bg-yellow-900 { background-color: #78350f; }
        
        .text-white { color: #ffffff; }
        .text-gray-300 { color: #d1d5db; }
        .text-gray-600 { color: #4b5563; }
        .text-gray-700 { color: #374151; }
        .text-gray-900 { color: #111827; }
        .text-blue-600 { color: #2563eb; }
        .text-blue-700 { color: #1d4ed8; }
        .text-green-600 { color: #16a34a; }
        .text-green-700 { color: #15803d; }
        .text-red-600 { color: #dc2626; }
        .text-red-700 { color: #b91c1c; }
        .text-yellow-600 { color: #d97706; }
        .text-yellow-800 { color: #92400e; }
        
        .border { border: 1px solid #e5e7eb; }
        .border-gray-300 { border-color: #d1d5db; }
        .border-gray-600 { border-color: #4b5563; }
        .border-gray-700 { border-color: #374151; }
        .border-blue-500 { border-color: #3b82f6; }
        .border-green-500 { border-color: #10b981; }
        .border-red-500 { border-color: #ef4444; }
        .border-yellow-200 { border-color: #fde68a; }
        .border-yellow-700 { border-color: #a16207; }
        
        .rounded { border-radius: 0.25rem; }
        .rounded-lg { border-radius: 0.5rem; }
        .rounded-full { border-radius: 9999px; }
        
        .shadow-sm { box-shadow: 0 1px 2px 0 rgb(0 0 0 / 0.05); }
        .shadow-lg { box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -2px rgb(0 0 0 / 0.05); }
        
        .p-2 { padding: 0.5rem; }
        .p-3 { padding: 0.75rem; }
        .p-4 { padding: 1rem; }
        .p-6 { padding: 1.5rem; }
        .p-8 { padding: 2rem; }
        .px-2 { padding-left: 0.5rem; padding-right: 0.5rem; }
        .px-3 { padding-left: 0.75rem; padding-right: 0.75rem; }
        .px-4 { padding-left: 1rem; padding-right: 1rem; }
        .py-1 { padding-top: 0.25rem; padding-bottom: 0.25rem; }
        .py-2 { padding-top: 0.5rem; padding-bottom: 0.5rem; }
        .py-3 { padding-top: 0.75rem; padding-bottom: 0.75rem; }
        .pl-10 { padding-left: 2.5rem; }
        .pr-4 { padding-right: 1rem; }
        
        .m-2 { margin: 0.5rem; }
        .m-4 { margin: 1rem; }
        .mb-2 { margin-bottom: 0.5rem; }
        .mb-4 { margin-bottom: 1rem; }
        .mb-6 { margin-bottom: 1.5rem; }
        .mb-8 { margin-bottom: 2rem; }
        .mr-2 { margin-right: 0.5rem; }
        .mt-1 { margin-top: 0.25rem; }
        .mt-2 { margin-top: 0.5rem; }
        .mx-auto { margin-left: auto; margin-right: auto; }
        
        .w-4 { width: 1rem; }
        .w-5 { width: 1.25rem; }
        .w-6 { width: 1.5rem; }
        .w-8 { width: 2rem; }
        .w-12 { width: 3rem; }
        .w-full { width: 100%; }
        .max-w-4xl { max-width: 56rem; }
        .max-w-7xl { max-width: 80rem; }
        
        .h-2 { height: 0.5rem; }
        .h-4 { height: 1rem; }
        .h-5 { height: 1.25rem; }
        .h-6 { height: 1.5rem; }
        .h-8 { height: 2rem; }
        .h-12 { height: 3rem; }
        .min-h-screen { min-height: 100vh; }
        .max-h-32 { max-height: 8rem; }
        
        .flex { display: flex; }
        .grid { display: grid; }
        .hidden { display: none; }
        .block { display: block; }
        .inline-flex { display: inline-flex; }
        
        .flex-col { flex-direction: column; }
        .items-center { align-items: center; }
        .items-start { align-items: flex-start; }
        .justify-center { justify-content: center; }
        .justify-between { justify-content: space-between; }
        .gap-2 { gap: 0.5rem; }
        .gap-3 { gap: 0.75rem; }
        .gap-4 { gap: 1rem; }
        .gap-6 { gap: 1.5rem; }
        .space-y-2 > * + * { margin-top: 0.5rem; }
        .space-y-3 > * + * { margin-top: 0.75rem; }
        .space-y-4 > * + * { margin-top: 1rem; }
        
        .grid-cols-1 { grid-template-columns: repeat(1, minmax(0, 1fr)); }
        .grid-cols-2 { grid-template-columns: repeat(2, minmax(0, 1fr)); }
        .grid-cols-4 { grid-template-columns: repeat(4, minmax(0, 1fr)); }
        
        .text-xs { font-size: 0.75rem; }
        .text-sm { font-size: 0.875rem; }
        .text-lg { font-size: 1.125rem; }
        .text-xl { font-size: 1.25rem; }
        .text-2xl { font-size: 1.5rem; }
        .text-3xl { font-size: 1.875rem; }
        .text-4xl { font-size: 2.25rem; }
        
        .font-medium { font-weight: 500; }
        .font-semibold { font-weight: 600; }
        .font-bold { font-weight: 700; }
        
        .text-center { text-align: center; }
        .text-left { text-align: left; }
        
        .cursor-pointer { cursor: pointer; }
        
        .overflow-hidden { overflow: hidden; }
        .overflow-y-auto { overflow-y: auto; }
        
        .relative { position: relative; }
        .absolute { position: absolute; }
        .fixed { position: fixed; }
        .top-4 { top: 1rem; }
        .right-4 { right: 1rem; }
        .left-3 { left: 0.75rem; }
        .top-1\/2 { top: 50%; }
        .z-50 { z-index: 50; }
        
        .transform { transform: translate(var(--tw-translate-x), var(--tw-translate-y)); }
        .-translate-y-1\/2 { --tw-translate-y: -50%; transform: translate(var(--tw-translate-x), var(--tw-translate-y)); }
        
        .transition-colors { transition: color 0.3s, background-color 0.3s, border-color 0.3s; }
        .transition-shadow { transition: box-shadow 0.3s; }
        .transition-all { transition: all 0.3s; }
        
        .hover\:bg-gray-50:hover { background-color: #f9fafb; }
        .hover\:bg-gray-200:hover { background-color: #e5e7eb; }
        .hover\:bg-gray-600:hover { background-color: #4b5563; }
        .hover\:bg-gray-700:hover { background-color: #374151; }
        .hover\:bg-blue-700:hover { background-color: #1d4ed8; }
        .hover\:shadow-md:hover { box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -1px rgb(0 0 0 / 0.06); }
        
        .focus\:outline-none:focus { outline: none; }
        .focus\:ring-2:focus { box-shadow: 0 0 0 2px #3b82f6; }
        .focus\:ring-blue-500:focus { box-shadow: 0 0 0 2px #3b82f6; }
        
        .border-l-4 { border-left-width: 4px; }
        .border-dashed { border-style: dashed; }
        
        .file-upload-area {
            border: 2px dashed #cbd5e1;
            border-radius: 0.5rem;
            padding: 2rem;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .file-upload-area:hover {
            border-color: #3b82f6;
            background-color: #f8fafc;
        }
        .file-upload-area.drag-over {
            border-color: #3b82f6;
            background-color: #eff6ff;
        }
        
        .animate-spin {
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        .animate-slide-in {
            animation: slide-in 0.3s ease-out;
        }
        
        @keyframes slide-in {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        button {
            border: none;
            background: none;
            cursor: pointer;
            font: inherit;
        }
        
        input, select {
            font: inherit;
        }
        
        .dark {
            background-color: #111827;
            color: #f9fafb;
        }
        
        .dark .bg-white {
            background-color: #1f2937;
        }
        
        .dark .bg-gray-50 {
            background-color: #111827;
        }
        
        .dark .text-gray-600 {
            color: #9ca3af;
        }
        
        .dark .text-gray-700 {
            color: #d1d5db;
        }
        
        .dark .text-gray-900 {
            color: #f9fafb;
        }
        
        .dark .border-gray-300 {
            border-color: #4b5563;
        }
        
        .dark .file-upload-area {
            border-color: #475569;
            background-color: #1e293b;
        }
        
        .dark .file-upload-area:hover {
            border-color: #3b82f6;
            background-color: #334155;
        }
        
        @media (min-width: 768px) {
            .md\:grid-cols-2 { grid-template-columns: repeat(2, minmax(0, 1fr)); }
            .md\:grid-cols-4 { grid-template-columns: repeat(4, minmax(0, 1fr)); }
        }
        
        @media (min-width: 1024px) {
            .lg\:grid-cols-2 { grid-template-columns: repeat(2, minmax(0, 1fr)); }
            .lg\:grid-cols-4 { grid-template-columns: repeat(4, minmax(0, 1fr)); }
            .lg\:flex-row { flex-direction: row; }
            .lg\:items-center { align-items: center; }
            .lg\:justify-between { justify-content: space-between; }
        }
        
        @media (min-width: 1280px) {
            .xl\:grid-cols-6 { grid-template-columns: repeat(6, minmax(0, 1fr)); }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script>
        // Wait for libraries to load with timeout
        function waitForLibraries() {
            return new Promise((resolve, reject) => {
                let attempts = 0;
                const maxAttempts = 50; // 5 seconds
                
                const checkLibraries = () => {
                    attempts++;
                    console.log(`Checking libraries... attempt ${attempts}`);
                    
                    if (typeof React !== 'undefined' && typeof ReactDOM !== 'undefined' && typeof XLSX !== 'undefined' && typeof _ !== 'undefined') {
                        console.log('All libraries loaded successfully!');
                        resolve();
                    } else if (attempts >= maxAttempts) {
                        console.error('Libraries failed to load after timeout');
                        reject(new Error('Libraries failed to load'));
                    } else {
                        setTimeout(checkLibraries, 100);
                    }
                };
                
                checkLibraries();
            });
        }
        
        // Start the app when libraries are ready
        waitForLibraries().then(() => {
            console.log('React:', typeof React);
            console.log('ReactDOM:', typeof ReactDOM);
            console.log('XLSX:', typeof XLSX);
            console.log('Lodash:', typeof _);
            
            const { useState, useEffect, useMemo, useCallback, useRef, createElement: e } = React;
            const { createRoot } = ReactDOM;

        // Icon Components
        const Upload = ({ className }) => e('svg', {
            className,
            xmlns: "http://www.w3.org/2000/svg",
            width: "24", height: "24", viewBox: "0 0 24 24",
            fill: "none", stroke: "currentColor", strokeWidth: "2",
            strokeLinecap: "round", strokeLinejoin: "round"
        }, [
            e('path', { key: 1, d: "M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" }),
            e('polyline', { key: 2, points: "17,8 12,3 7,8" }),
            e('line', { key: 3, x1: "12", x2: "12", y1: "3", y2: "15" })
        ]);

        const RefreshCw = ({ className }) => e('svg', {
            className,
            xmlns: "http://www.w3.org/2000/svg",
            width: "24", height: "24", viewBox: "0 0 24 24",
            fill: "none", stroke: "currentColor", strokeWidth: "2",
            strokeLinecap: "round", strokeLinejoin: "round"
        }, [
            e('path', { key: 1, d: "M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8" }),
            e('path', { key: 2, d: "M21 3v5h-5" }),
            e('path', { key: 3, d: "M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16" }),
            e('path', { key: 4, d: "M8 16H3v5" })
        ]);

        const Download = ({ className }) => e('svg', {
            className,
            xmlns: "http://www.w3.org/2000/svg",
            width: "24", height: "24", viewBox: "0 0 24 24",
            fill: "none", stroke: "currentColor", strokeWidth: "2",
            strokeLinecap: "round", strokeLinejoin: "round"
        }, [
            e('path', { key: 1, d: "M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" }),
            e('polyline', { key: 2, points: "7,10 12,15 17,10" }),
            e('line', { key: 3, x1: "12", x2: "12", y1: "15", y2: "3" })
        ]);

        const Sun = ({ className }) => e('svg', {
            className,
            xmlns: "http://www.w3.org/2000/svg",
            width: "24", height: "24", viewBox: "0 0 24 24",
            fill: "none", stroke: "currentColor", strokeWidth: "2",
            strokeLinecap: "round", strokeLinejoin: "round"
        }, [
            e('circle', { key: 1, cx: "12", cy: "12", r: "4" }),
            e('path', { key: 2, d: "M12 2v2" }),
            e('path', { key: 3, d: "M12 20v2" })
        ]);

        const Moon = ({ className }) => e('svg', {
            className,
            xmlns: "http://www.w3.org/2000/svg",
            width: "24", height: "24", viewBox: "0 0 24 24",
            fill: "none", stroke: "currentColor", strokeWidth: "2",
            strokeLinecap: "round", strokeLinejoin: "round"
        }, [
            e('path', { key: 1, d: "M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z" })
        ]);

        // Main Component
        const IpcAnalysisTool = () => {
            const [data, setData] = useState([]);
            const [loading, setLoading] = useState(false);
            const [darkMode, setDarkMode] = useState(false);
            const [fileUploaded, setFileUploaded] = useState(false);
            const [uploadError, setUploadError] = useState(null);

            const fileInputRef = useRef(null);

            const handleFileUpload = async (file) => {
                if (!file) return;

                try {
                    setLoading(true);
                    setUploadError(null);
                    
                    const arrayBuffer = await file.arrayBuffer();
                    const workbook = XLSX.read(arrayBuffer);

                    if (!workbook.SheetNames.includes('Data')) {
                        throw new Error('Excel bestand moet een "Data" sheet bevatten');
                    }

                    const dataSheet = workbook.Sheets['Data'];
                    const rawData = XLSX.utils.sheet_to_json(dataSheet);
                    
                    if (rawData.length === 0) {
                        throw new Error('Data sheet is leeg');
                    }

                    console.log('Data geladen:', rawData.length, 'records');
                    setData(rawData);
                    setFileUploaded(true);
                    
                } catch (error) {
                    console.error('Error loading data:', error);
                    setUploadError(error.message);
                } finally {
                    setLoading(false);
                }
            };

            const FileUploadArea = () => {
                const [dragOver, setDragOver] = useState(false);

                const handleDrop = (event) => {
                    event.preventDefault();
                    setDragOver(false);
                    const files = event.dataTransfer.files;
                    if (files.length > 0) {
                        handleFileUpload(files[0]);
                    }
                };

                return e('div', 
                    {
                        className: `file-upload-area ${dragOver ? 'drag-over' : ''}`,
                        onDrop: handleDrop,
                        onDragOver: (e) => { e.preventDefault(); setDragOver(true); },
                        onDragLeave: (e) => { e.preventDefault(); setDragOver(false); },
                        onClick: () => fileInputRef.current?.click()
                    },
                    e('div', { className: 'flex flex-col items-center gap-4' }, [
                        e(Upload, { key: 'icon', className: 'w-12 h-12 text-gray-400' }),
                        e('div', { key: 'text', className: 'text-center' }, [
                            e('p', { key: 'title', className: 'text-lg font-medium text-gray-700' }, 'Upload IPC Data Excel Bestand'),
                            e('p', { key: 'subtitle', className: 'text-sm text-gray-600 mt-1' }, 'Sleep het bestand hierheen of klik om te selecteren')
                        ]),
                        e('input', {
                            key: 'input',
                            ref: fileInputRef,
                            type: 'file',
                            accept: '.xlsx,.xls',
                            onChange: (event) => {
                                if (event.target.files.length > 0) {
                                    handleFileUpload(event.target.files[0]);
                                }
                            },
                            className: 'hidden'
                        })
                    ])
                );
            };

            useEffect(() => {
                if (darkMode) {
                    document.body.classList.add('dark');
                } else {
                    document.body.classList.remove('dark');
                }
            }, [darkMode]);

            if (!fileUploaded) {
                return e('div', 
                    { className: `min-h-screen transition-colors ${darkMode ? 'bg-gray-900 text-white' : 'bg-gray-50 text-gray-900'} p-6` },
                    e('div', { className: 'max-w-4xl mx-auto' }, [
                        e('div', 
                            { key: 'header', className: `${darkMode ? 'bg-gray-800' : 'bg-white'} rounded-lg shadow-sm p-8 mb-8 text-center` },
                            [
                                e('h1', 
                                    { key: 'title', className: 'text-4xl font-bold mb-4 text-blue-600' },
                                    'IPC Requests Analyse Dashboard'
                                ),
                                e('p', 
                                    { key: 'subtitle', className: `${darkMode ? 'text-gray-300' : 'text-gray-600'} text-xl mb-6` },
                                    'Upload je Excel bestand om geavanceerde analyses te starten'
                                ),
                                e('button',
                                    {
                                        key: 'dark-toggle',
                                        onClick: () => setDarkMode(!darkMode),
                                        className: `p-3 rounded-lg ${darkMode ? 'bg-gray-700 hover:bg-gray-600' : 'bg-gray-100 hover:bg-gray-200'} transition-colors`
                                    },
                                    darkMode ? e(Sun, { className: 'w-6 h-6' }) : e(Moon, { className: 'w-6 h-6' })
                                )
                            ]
                        ),
                        e('div', 
                            { key: 'upload', className: `${darkMode ? 'bg-gray-800' : 'bg-white'} rounded-lg shadow-sm p-8 mb-8` },
                            loading ? 
                                e('div', { key: 'loading', className: 'text-center py-12' }, [
                                    e(RefreshCw, { key: 'spinner', className: 'w-12 h-12 animate-spin mx-auto mb-4 text-blue-600' }),
                                    e('p', { key: 'text', className: 'text-lg' }, 'Bestand wordt verwerkt...')
                                ])
                                :
                                e(FileUploadArea, { key: 'upload-area' })
                        ),
                        uploadError && e('div', 
                            { key: 'error', className: 'bg-red-50 border border-red-200 rounded-lg p-6' },
                            e('p', { className: 'text-red-600' }, uploadError)
                        )
                    ])
                );
            }

            return e('div', 
                { className: `min-h-screen ${darkMode ? 'bg-gray-900 text-white' : 'bg-gray-50 text-gray-900'} p-6` },
                e('div', { className: 'max-w-7xl mx-auto' }, [
                    e('div', 
                        { key: 'header', className: `${darkMode ? 'bg-gray-800' : 'bg-white'} rounded-lg shadow-sm p-6 mb-6` },
                        e('div', { className: 'flex justify-between items-center' }, [
                            e('div', { key: 'title' }, [
                                e('h1', { className: 'text-3xl font-bold text-blue-600' }, 'IPC Dashboard'),
                                e('p', { className: `${darkMode ? 'text-gray-300' : 'text-gray-600'}` }, 
                                    `${data.length.toLocaleString()} records geladen`
                                )
                            ]),
                            e('button',
                                {
                                    onClick: () => setDarkMode(!darkMode),
                                    className: `p-2 rounded-lg ${darkMode ? 'bg-gray-700 hover:bg-gray-600' : 'bg-gray-100 hover:bg-gray-200'} transition-colors`
                                },
                                darkMode ? e(Sun, { className: 'w-5 h-5' }) : e(Moon, { className: 'w-5 h-5' })
                            )
                        ])
                    ),
                    e('div', 
                        { key: 'success', className: 'bg-green-50 border border-green-200 rounded-lg p-6 text-center' },
                        [
                            e('h2', { key: 'title', className: 'text-xl font-semibold text-green-800 mb-2' }, 'Data Succesvol Geladen!'),
                            e('p', { key: 'message', className: 'text-green-600' }, 
                                `${data.length.toLocaleString()} records uit je Excel bestand zijn verwerkt en klaar voor analyse.`
                            ),
                            e('button', {
                                key: 'reload',
                                onClick: () => window.location.reload(),
                                className: 'mt-4 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors'
                            }, 'Nieuw Bestand Uploaden')
                        ]
                    )
                ])
            );
        };

            // Render the app using React 18 API
            const root = createRoot(document.getElementById('root'));
            root.render(e(IpcAnalysisTool));
            
        }).catch(error => {
            console.error('Failed to load libraries:', error);
            document.getElementById('root').innerHTML = `
                <div style="padding: 2rem; text-align: center; color: red; font-family: Arial, sans-serif;">
                    <h2>⚠️ Loading Error</h2>
                    <p>Required libraries failed to load. Please:</p>
                    <ul style="text-align: left; display: inline-block;">
                        <li>Check your internet connection</li>
                        <li>Refresh the page (Ctrl+F5 or Cmd+Shift+R)</li>
                        <li>Try again in a few moments</li>
                    </ul>
                    <button onclick="window.location.reload()" style="margin-top: 1rem; padding: 0.5rem 1rem; background: #3b82f6; color: white; border: none; border-radius: 0.25rem; cursor: pointer;">
                        Refresh Page
                    </button>
                </div>
            `;
        });
    </script>
</body>
</html>
