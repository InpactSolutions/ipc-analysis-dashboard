<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IPC Requests Analyse Dashboard</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/recharts/2.8.0/umd/Recharts.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.21/lodash.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .file-upload-area {
            border: 2px dashed #cbd5e1;
            border-radius: 0.5rem;
            padding: 2rem;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .file-upload-area:hover {
            border-color: #3b82f6;
            background-color: #f8fafc;
        }
        .file-upload-area.drag-over {
            border-color: #3b82f6;
            background-color: #eff6ff;
        }
        .dark .file-upload-area {
            border-color: #475569;
            background-color: #1e293b;
        }
        .dark .file-upload-area:hover {
            border-color: #3b82f6;
            background-color: #334155;
        }
        
        @keyframes slide-in {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        .animate-slide-in {
            animation: slide-in 0.3s ease-out;
        }
        
        .animate-spin {
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            from {
                transform: rotate(0deg);
            }
            to {
                transform: rotate(360deg);
            }
        }
        
        .animate-pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        
        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: .5;
            }
        }
        
        .transition-colors {
            transition-property: color, background-color, border-color, text-decoration-color, fill, stroke;
            transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
            transition-duration: 300ms;
        }
        
        .transition-all {
            transition-property: all;
            transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
            transition-duration: 300ms;
        }
        
        .transition-shadow {
            transition-property: box-shadow;
            transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
            transition-duration: 300ms;
        }
        
        .bg-gradient-to-r {
            background-image: linear-gradient(to right, var(--tw-gradient-stops));
        }
        
        .from-blue-600 {
            --tw-gradient-from: #2563eb;
            --tw-gradient-to: rgb(37 99 235 / 0);
            --tw-gradient-stops: var(--tw-gradient-from), var(--tw-gradient-to);
        }
        
        .to-purple-600 {
            --tw-gradient-to: #9333ea;
        }
        
        .bg-clip-text {
            -webkit-background-clip: text;
            background-clip: text;
        }
        
        .text-transparent {
            color: transparent;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useCallback, useRef } = React;
        const { 
            BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, Legend, 
            ResponsiveContainer, LineChart, Line, PieChart, Pie, Cell, 
            Area, AreaChart, ScatterChart, Scatter, ComposedChart, ReferenceLine 
        } = Recharts;

        // Lucide Icons
        const Calendar = () => React.createElement('svg', {
            xmlns: "http://www.w3.org/2000/svg",
            width: "24", height: "24", viewBox: "0 0 24 24",
            fill: "none", stroke: "currentColor", strokeWidth: "2",
            strokeLinecap: "round", strokeLinejoin: "round"
        }, [
            React.createElement('path', { key: 1, d: "M8 2v4" }),
            React.createElement('path', { key: 2, d: "M16 2v4" }),
            React.createElement('rect', { key: 3, width: "18", height: "18", x: "3", y: "4", rx: "2" }),
            React.createElement('path', { key: 4, d: "M3 10h18" })
        ]);

        const TrendingUp = () => React.createElement('svg', {
            xmlns: "http://www.w3.org/2000/svg",
            width: "24", height: "24", viewBox: "0 0 24 24",
            fill: "none", stroke: "currentColor", strokeWidth: "2",
            strokeLinecap: "round", strokeLinejoin: "round"
        }, [
            React.createElement('polyline', { key: 1, points: "22,7 13.5,15.5 8.5,10.5 2,17" }),
            React.createElement('polyline', { key: 2, points: "16,7 22,7 22,13" })
        ]);

        const Users = () => React.createElement('svg', {
            xmlns: "http://www.w3.org/2000/svg",
            width: "24", height: "24", viewBox: "0 0 24 24",
            fill: "none", stroke: "currentColor", strokeWidth: "2",
            strokeLinecap: "round", strokeLinejoin: "round"
        }, [
            React.createElement('path', { key: 1, d: "M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2" }),
            React.createElement('circle', { key: 2, cx: "9", cy: "7", r: "4" }),
            React.createElement('path', { key: 3, d: "m22 21-1.5-1.5" }),
            React.createElement('path', { key: 4, d: "M17 17.25c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2z" })
        ]);

        const Package = () => React.createElement('svg', {
            xmlns: "http://www.w3.org/2000/svg",
            width: "24", height: "24", viewBox: "0 0 24 24",
            fill: "none", stroke: "currentColor", strokeWidth: "2",
            strokeLinecap: "round", strokeLinejoin: "round"
        }, [
            React.createElement('path', { key: 1, d: "m7.5 4.27 9 5.15" }),
            React.createElement('path', { key: 2, d: "M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z" }),
            React.createElement('path', { key: 3, d: "m3.3 7 8.7 5 8.7-5" }),
            React.createElement('path', { key: 4, d: "M12 22V12" })
        ]);

        const Download = () => React.createElement('svg', {
            xmlns: "http://www.w3.org/2000/svg",
            width: "24", height: "24", viewBox: "0 0 24 24",
            fill: "none", stroke: "currentColor", strokeWidth: "2",
            strokeLinecap: "round", strokeLinejoin: "round"
        }, [
            React.createElement('path', { key: 1, d: "M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" }),
            React.createElement('polyline', { key: 2, points: "7,10 12,15 17,10" }),
            React.createElement('line', { key: 3, x1: "12", x2: "12", y1: "15", y2: "3" })
        ]);

        const RefreshCw = () => React.createElement('svg', {
            xmlns: "http://www.w3.org/2000/svg",
            width: "24", height: "24", viewBox: "0 0 24 24",
            fill: "none", stroke: "currentColor", strokeWidth: "2",
            strokeLinecap: "round", strokeLinejoin: "round"
        }, [
            React.createElement('path', { key: 1, d: "M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8" }),
            React.createElement('path', { key: 2, d: "M21 3v5h-5" }),
            React.createElement('path', { key: 3, d: "M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16" }),
            React.createElement('path', { key: 4, d: "M8 16H3v5" })
        ]);

        const Upload = () => React.createElement('svg', {
            xmlns: "http://www.w3.org/2000/svg",
            width: "24", height: "24", viewBox: "0 0 24 24",
            fill: "none", stroke: "currentColor", strokeWidth: "2",
            strokeLinecap: "round", strokeLinejoin: "round"
        }, [
            React.createElement('path', { key: 1, d: "M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" }),
            React.createElement('polyline', { key: 2, points: "17,8 12,3 7,8" }),
            React.createElement('line', { key: 3, x1: "12", x2: "12", y1: "3", y2: "15" })
        ]);

        const Filter = () => React.createElement('svg', {
            xmlns: "http://www.w3.org/2000/svg",
            width: "24", height: "24", viewBox: "0 0 24 24",
            fill: "none", stroke: "currentColor", strokeWidth: "2",
            strokeLinecap: "round", strokeLinejoin: "round"
        }, [
            React.createElement('polygon', { key: 1, points: "22,3 2,3 10,12.46 10,19 14,21 14,12.46" })
        ]);

        const Search = () => React.createElement('svg', {
            xmlns: "http://www.w3.org/2000/svg",
            width: "24", height: "24", viewBox: "0 0 24 24",
            fill: "none", stroke: "currentColor", strokeWidth: "2",
            strokeLinecap: "round", strokeLinejoin: "round"
        }, [
            React.createElement('circle', { key: 1, cx: "11", cy: "11", r: "8" }),
            React.createElement('path', { key: 2, d: "m21 21-4.35-4.35" })
        ]);

        const Moon = () => React.createElement('svg', {
            xmlns: "http://www.w3.org/2000/svg",
            width: "24", height: "24", viewBox: "0 0 24 24",
            fill: "none", stroke: "currentColor", strokeWidth: "2",
            strokeLinecap: "round", strokeLinejoin: "round"
        }, [
            React.createElement('path', { key: 1, d: "M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z" })
        ]);

        const Sun = () => React.createElement('svg', {
            xmlns: "http://www.w3.org/2000/svg",
            width: "24", height: "24", viewBox: "0 0 24 24",
            fill: "none", stroke: "currentColor", strokeWidth: "2",
            strokeLinecap: "round", strokeLinejoin: "round"
        }, [
            React.createElement('circle', { key: 1, cx: "12", cy: "12", r: "4" }),
            React.createElement('path', { key: 2, d: "M12 2v2" }),
            React.createElement('path', { key: 3, d: "M12 20v2" }),
            React.createElement('path', { key: 4, d: "m4.93 4.93 1.41 1.41" }),
            React.createElement('path', { key: 5, d: "m17.66 17.66 1.41 1.41" }),
            React.createElement('path', { key: 6, d: "M2 12h2" }),
            React.createElement('path', { key: 7, d: "M20 12h2" }),
            React.createElement('path', { key: 8, d: "m6.34 17.66-1.41 1.41" }),
            React.createElement('path', { key: 9, d: "m19.07 4.93-1.41 1.41" })
        ]);

        const ChevronDown = () => React.createElement('svg', {
            xmlns: "http://www.w3.org/2000/svg",
            width: "24", height: "24", viewBox: "0 0 24 24",
            fill: "none", stroke: "currentColor", strokeWidth: "2",
            strokeLinecap: "round", strokeLinejoin: "round"
        }, [
            React.createElement('path', { key: 1, d: "m6 9 6 6 6-6" })
        ]);

        const ChevronUp = () => React.createElement('svg', {
            xmlns: "http://www.w3.org/2000/svg",
            width: "24", height: "24", viewBox: "0 0 24 24",
            fill: "none", stroke: "currentColor", strokeWidth: "2",
            strokeLinecap: "round", strokeLinejoin: "round"
        }, [
            React.createElement('path', { key: 1, d: "m18 15-6-6-6 6" })
        ]);

        const AlertTriangle = () => React.createElement('svg', {
            xmlns: "http://www.w3.org/2000/svg",
            width: "24", height: "24", viewBox: "0 0 24 24",
            fill: "none", stroke: "currentColor", strokeWidth: "2",
            strokeLinecap: "round", strokeLinejoin: "round"
        }, [
            React.createElement('path', { key: 1, d: "m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z" }),
            React.createElement('path', { key: 2, d: "M12 9v4" }),
            React.createElement('path', { key: 3, d: "m12 17 .01 0" })
        ]);

        const ArrowUp = () => React.createElement('svg', {
            xmlns: "http://www.w3.org/2000/svg",
            width: "24", height: "24", viewBox: "0 0 24 24",
            fill: "none", stroke: "currentColor", strokeWidth: "2",
            strokeLinecap: "round", strokeLinejoin: "round"
        }, [
            React.createElement('path', { key: 1, d: "m5 12 7-7 7 7" }),
            React.createElement('path', { key: 2, d: "M12 19V5" })
        ]);

        const ArrowDown = () => React.createElement('svg', {
            xmlns: "http://www.w3.org/2000/svg",
            width: "24", height: "24", viewBox: "0 0 24 24",
            fill: "none", stroke: "currentColor", strokeWidth: "2",
            strokeLinecap: "round", strokeLinejoin: "round"
        }, [
            React.createElement('path', { key: 1, d: "M12 5v14" }),
            React.createElement('path', { key: 2, d: "m19 12-7 7-7-7" })
        ]);

        const Database = () => React.createElement('svg', {
            xmlns: "http://www.w3.org/2000/svg",
            width: "24", height: "24", viewBox: "0 0 24 24",
            fill: "none", stroke: "currentColor", strokeWidth: "2",
            strokeLinecap: "round", strokeLinejoin: "round"
        }, [
            React.createElement('ellipse', { key: 1, cx: "12", cy: "5", rx: "9", ry: "3" }),
            React.createElement('path', { key: 2, d: "M3 5v14c0 1.66 4.03 3 9 3s9-1.34 9-3V5" }),
            React.createElement('path', { key: 3, d: "M3 12c0 1.66 4.03 3 9 3s9-1.34 9-3" })
        ]);

        const Eye = () => React.createElement('svg', {
            xmlns: "http://www.w3.org/2000/svg",
            width: "24", height: "24", viewBox: "0 0 24 24",
            fill: "none", stroke: "currentColor", strokeWidth: "2",
            strokeLinecap: "round", strokeLinejoin: "round"
        }, [
            React.createElement('path', { key: 1, d: "M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z" }),
            React.createElement('circle', { key: 2, cx: "12", cy: "12", r: "3" })
        ]);

        const IpcAnalysisTool = () => {
            // Core state
            const [data, setData] = useState([]);
            const [filteredData, setFilteredData] = useState([]);
            const [loading, setLoading] = useState(false);
            const [darkMode, setDarkMode] = useState(false);
            const [currentView, setCurrentView] = useState('dashboard');
            const [fileUploaded, setFileUploaded] = useState(false);
            const [uploadError, setUploadError] = useState(null);

            // Filter state
            const [filters, setFilters] = useState({
                environment: [],
                insurer: [],
                product: [],
                dateRange: 'all',
                searchTerm: ''
            });

            // UI state
            const [collapsedSections, setCollapsedSections] = useState({});
            const [notifications, setNotifications] = useState([]);

            // Chart state
            const [chartTypes, setChartTypes] = useState({
                monthly: 'area',
                insurer: 'bar',
                product: 'bar',
                environment: 'pie'
            });

            // Data processing state
            const [uniqueValues, setUniqueValues] = useState({
                environments: [],
                insurers: [],
                products: [],
                users: [],
                engines: []
            });

            const fileInputRef = useRef(null);

            // File upload handler
            const handleFileUpload = async (file) => {
                if (!file) return;

                try {
                    setLoading(true);
                    setUploadError(null);
                    
                    const arrayBuffer = await file.arrayBuffer();
                    const workbook = XLSX.read(arrayBuffer, {
                        cellStyles: true,
                        cellFormulas: true,
                        cellDates: true,
                        cellNF: true,
                        sheetStubs: true
                    });

                    // Check if 'Data' sheet exists
                    if (!workbook.SheetNames.includes('Data')) {
                        throw new Error('Excel bestand moet een "Data" sheet bevatten');
                    }

                    const dataSheet = workbook.Sheets['Data'];
                    const rawData = XLSX.utils.sheet_to_json(dataSheet);
                    
                    if (rawData.length === 0) {
                        throw new Error('Data sheet is leeg');
                    }

                    // Enhanced data processing
                    const processedData = rawData.map((row, index) => {
                        const date = row.YyyyMm ? new Date(row.YyyyMm) : null;
                        return {
                            ...row,
                            id: index,
                            YyyyMm: date,
                            Aantal: parseInt(row.Aantal) || 0,
                            month: date ? date.toLocaleDateString('nl-NL', { year: 'numeric', month: 'short' }) : 'Onbekend',
                            year: date ? date.getFullYear() : 'Onbekend',
                            quarter: date ? `Q${Math.floor(date.getMonth() / 3) + 1} ${date.getFullYear()}` : 'Onbekend',
                            userCategory: categorizeUser(row.Gebruiker, row.Aantal),
                            productCategory: categorizeProduct(row.Product),
                            volumeCategory: categorizeVolume(row.Aantal),
                            hasValidDate: !!date,
                            hasValidUser: !!row.Gebruiker && row.Gebruiker !== 'NULL',
                            completeness: calculateCompleteness(row)
                        };
                    });

                    setData(processedData);
                    setFilteredData(processedData);

                    // Extract unique values
                    setUniqueValues({
                        environments: _.uniq(processedData.map(d => d.Environment)).filter(Boolean),
                        insurers: _.uniq(processedData.map(d => d.Insurer)).filter(Boolean).sort(),
                        products: _.uniq(processedData.map(d => d.Product)).filter(Boolean).sort(),
                        users: _.uniq(processedData.map(d => d.Gebruiker)).filter(d => d && d !== 'NULL').sort(),
                        engines: _.uniq(processedData.map(d => d.Engine)).filter(Boolean).sort()
                    });

                    setFileUploaded(true);
                    addNotification('success', `${processedData.length.toLocaleString()} records succesvol geladen`);
                    
                } catch (error) {
                    console.error('Error loading data:', error);
                    setUploadError(error.message);
                    addNotification('error', `Fout bij laden: ${error.message}`);
                } finally {
                    setLoading(false);
                }
            };

            // Helper functions for data processing
            const categorizeUser = (user, aantal) => {
                if (!user || user === 'NULL') return 'Unknown';
                if (aantal > 10000) return 'Enterprise';
                if (aantal > 1000) return 'Large';
                if (aantal > 100) return 'Medium';
                return 'Small';
            };

            const categorizeProduct = (product) => {
                if (!product) return 'Unknown';
                if (product.toLowerCase().includes('auto')) return 'Auto';
                if (product.toLowerCase().includes('woning')) return 'Property';
                if (product.toLowerCase().includes('aansprakelijk')) return 'Liability';
                if (product.toLowerCase().includes('reis')) return 'Travel';
                return 'Other';
            };

            const categorizeVolume = (aantal) => {
                if (aantal > 50000) return 'Very High';
                if (aantal > 10000) return 'High';
                if (aantal > 1000) return 'Medium';
                if (aantal > 100) return 'Low';
                return 'Very Low';
            };

            const calculateCompleteness = (row) => {
                const fields = ['Environment', 'YyyyMm', 'Engine', 'Insurer', 'Product', 'Gebruiker', 'Aantal'];
                const validFields = fields.filter(field => row[field] && row[field] !== 'NULL' && row[field] !== null);
                return (validFields.length / fields.length) * 100;
            };

            // Enhanced filtering
            const applyFilters = useCallback(() => {
                let filtered = [...data];

                if (filters.environment.length > 0) {
                    filtered = filtered.filter(d => filters.environment.includes(d.Environment));
                }
                if (filters.insurer.length > 0) {
                    filtered = filtered.filter(d => filters.insurer.includes(d.Insurer));
                }
                if (filters.product.length > 0) {
                    filtered = filtered.filter(d => filters.product.includes(d.Product));
                }

                if (filters.dateRange !== 'all') {
                    const now = new Date();
                    const cutoff = new Date();
                    switch (filters.dateRange) {
                        case '1year':
                            cutoff.setFullYear(now.getFullYear() - 1);
                            break;
                        case '6months':
                            cutoff.setMonth(now.getMonth() - 6);
                            break;
                        case '3months':
                            cutoff.setMonth(now.getMonth() - 3);
                            break;
                        case '1month':
                            cutoff.setMonth(now.getMonth() - 1);
                            break;
                    }
                    filtered = filtered.filter(d => d.YyyyMm && d.YyyyMm >= cutoff);
                }

                if (filters.searchTerm) {
                    const searchLower = filters.searchTerm.toLowerCase();
                    filtered = filtered.filter(d => 
                        (d.Insurer && d.Insurer.toLowerCase().includes(searchLower)) ||
                        (d.Product && d.Product.toLowerCase().includes(searchLower)) ||
                        (d.Gebruiker && d.Gebruiker.toLowerCase().includes(searchLower)) ||
                        (d.Engine && d.Engine.toLowerCase().includes(searchLower))
                    );
                }

                setFilteredData(filtered);
            }, [data, filters]);

            useEffect(() => {
                applyFilters();
            }, [applyFilters]);

            // Notification system
            const addNotification = (type, message) => {
                const id = Date.now();
                setNotifications(prev => [...prev, { id, type, message, timestamp: new Date() }]);
                setTimeout(() => {
                    setNotifications(prev => prev.filter(n => n.id !== id));
                }, 5000);
            };

            // Enhanced statistics
            const stats = useMemo(() => {
                const totalRequests = filteredData.reduce((sum, d) => sum + d.Aantal, 0);
                const uniqueUsers = _.uniq(filteredData.map(d => d.Gebruiker)).length;
                const uniqueProducts = _.uniq(filteredData.map(d => d.Product)).length;
                const uniqueInsurers = _.uniq(filteredData.map(d => d.Insurer)).length;
                const avgPerMonth = filteredData.length > 0 ? Math.round(totalRequests / _.uniq(filteredData.map(d => d.month)).length) : 0;
                const dataQuality = _.mean(filteredData.map(d => d.completeness)) || 0;

                return {
                    totalRequests,
                    uniqueUsers,
                    uniqueProducts,
                    uniqueInsurers,
                    avgPerMonth,
                    totalRecords: filteredData.length,
                    dataQuality
                };
            }, [filteredData]);

            // Chart data generators
            const getMonthlyData = () => {
                const grouped = _.groupBy(filteredData, 'month');
                return Object.entries(grouped)
                    .map(([month, records]) => ({
                        month,
                        requests: records.reduce((sum, r) => sum + r.Aantal, 0),
                        records: records.length,
                        uniqueUsers: _.uniq(records.map(r => r.Gebruiker)).length
                    }))
                    .sort((a, b) => new Date(a.month) - new Date(b.month));
            };

            const getInsurerData = () => {
                const grouped = _.groupBy(filteredData, 'Insurer');
                return Object.entries(grouped)
                    .map(([insurer, records]) => ({
                        insurer,
                        requests: records.reduce((sum, r) => sum + r.Aantal, 0),
                        records: records.length,
                        uniqueUsers: _.uniq(records.map(r => r.Gebruiker)).length
                    }))
                    .sort((a, b) => b.requests - a.requests)
                    .slice(0, 10);
            };

            const getProductData = () => {
                const grouped = _.groupBy(filteredData, 'Product');
                return Object.entries(grouped)
                    .map(([product, records]) => ({
                        product: product.length > 25 ? product.substring(0, 25) + '...' : product,
                        fullProduct: product,
                        requests: records.reduce((sum, r) => sum + r.Aantal, 0),
                        records: records.length
                    }))
                    .sort((a, b) => b.requests - a.requests)
                    .slice(0, 10);
            };

            const getEnvironmentData = () => {
                const grouped = _.groupBy(filteredData, 'Environment');
                return Object.entries(grouped)
                    .map(([env, records]) => ({
                        environment: env,
                        requests: records.reduce((sum, r) => sum + r.Aantal, 0),
                        records: records.length,
                        share: (records.reduce((sum, r) => sum + r.Aantal, 0) / filteredData.reduce((sum, r) => sum + r.Aantal, 0)) * 100
                    }));
            };

            // Multi-select filter helper
            const handleMultiSelectFilter = (type, value) => {
                setFilters(prev => ({
                    ...prev,
                    [type]: prev[type].includes(value) 
                        ? prev[type].filter(v => v !== value)
                        : [...prev[type], value]
                }));
            };

            // Export functionality
            const exportData = (format) => {
                const timestamp = new Date().toISOString().split('T')[0];
                
                switch (format) {
                    case 'excel':
                        const wb = XLSX.utils.book_new();
                        const ws = XLSX.utils.json_to_sheet(filteredData);
                        XLSX.utils.book_append_sheet(wb, ws, 'Filtered Data');
                        XLSX.writeFile(wb, `ipc-analysis-${timestamp}.xlsx`);
                        break;
                    case 'csv':
                        const csv = [
                            Object.keys(filteredData[0] || {}).join(','),
                            ...filteredData.map(row => Object.values(row).join(','))
                        ].join('\n');
                        const blob = new Blob([csv], { type: 'text/csv' });
                        const url = URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = `ipc-analysis-${timestamp}.csv`;
                        a.click();
                        break;
                }
                addNotification('success', `Data geÃ«xporteerd als ${format.toUpperCase()}`);
            };

            const colors = ['#3b82f6', '#ef4444', '#10b981', '#f59e0b', '#8b5cf6', '#ec4899'];

            // File upload area component
            const FileUploadArea = () => {
                const [dragOver, setDragOver] = useState(false);

                const handleDrop = (e) => {
                    e.preventDefault();
                    setDragOver(false);
                    const files = e.dataTransfer.files;
                    if (files.length > 0) {
                        handleFileUpload(files[0]);
                    }
                };

                const handleDragOver = (e) => {
                    e.preventDefault();
                    setDragOver(true);
                };

                const handleDragLeave = (e) => {
                    e.preventDefault();
                    setDragOver(false);
                };

                return React.createElement('div', 
                    {
                        className: `file-upload-area ${dragOver ? 'drag-over' : ''}`,
                        onDrop: handleDrop,
                        onDragOver: handleDragOver,
                        onDragLeave: handleDragLeave,
                        onClick: () => fileInputRef.current?.click()
                    },
                    React.createElement('div', { className: 'flex flex-col items-center gap-4' }, [
                        React.createElement(Upload, { key: 'icon', className: 'w-12 h-12 text-gray-400' }),
                        React.createElement('div', { key: 'text', className: 'text-center' }, [
                            React.createElement('p', { key: 'title', className: 'text-lg font-medium text-gray-700 dark:text-gray-300' }, 'Upload IPC Data Excel Bestand'),
                            React.createElement('p', { key: 'subtitle', className: 'text-sm text-gray-500 dark:text-gray-400 mt-1' }, 'Sleep het bestand hierheen of klik om te selecteren'),
                            React.createElement('p', { key: 'requirement', className: 'text-xs text-gray-400 mt-2' }, 'Excel bestand moet een "Data" sheet bevatten')
                        ]),
                        React.createElement('input', {
                            key: 'input',
                            ref: fileInputRef,
                            type: 'file',
                            accept: '.xlsx,.xls',
                            onChange: (e) => {
                                if (e.target.files.length > 0) {
                                    handleFileUpload(e.target.files[0]);
                                }
                            },
                            className: 'hidden'
                        })
                    ])
                );
            };

            if (!fileUploaded) {
                return React.createElement('div', 
                    { className: `min-h-screen transition-colors duration-300 ${darkMode ? 'bg-gray-900 text-white' : 'bg-gray-50 text-gray-900'} p-6` },
                    [
                        // Notifications
                        React.createElement('div', { key: 'notifications', className: 'fixed top-4 right-4 z-50 space-y-2' },
                            notifications.map(notification =>
                                React.createElement('div',
                                    {
                                        key: notification.id,
                                        className: `p-3 rounded-lg shadow-lg border-l-4 animate-slide-in ${
                                            notification.type === 'error' ? 'bg-red-50 border-red-500 text-red-700' :
                                            notification.type === 'success' ? 'bg-green-50 border-green-500 text-green-700' :
                                            'bg-blue-50 border-blue-500 text-blue-700'
                                        }`
                                    },
                                    React.createElement('div', { className: 'flex items-center gap-2' }, [
                                        notification.type === 'error' && React.createElement(AlertTriangle, { key: 'icon', className: 'w-4 h-4' }),
                                        React.createElement('span', { key: 'message', className: 'text-sm font-medium' }, notification.message)
                                    ])
                                )
                            )
                        ),
                        
                        React.createElement('div', { key: 'main', className: 'max-w-4xl mx-auto' }, [
                            // Header
                            React.createElement('div', 
                                { key: 'header', className: `${darkMode ? 'bg-gray-800' : 'bg-white'} rounded-lg shadow-sm p-8 mb-8 text-center` },
                                [
                                    React.createElement('h1', 
                                        { key: 'title', className: 'text-4xl font-bold mb-4 bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent' },
                                        'IPC Requests Analyse Dashboard'
                                    ),
                                    React.createElement('p', 
                                        { key: 'subtitle', className: `${darkMode ? 'text-gray-300' : 'text-gray-600'} text-xl mb-6` },
                                        'Upload je Excel bestand om geavanceerde analyses te starten'
                                    ),
                                    React.createElement('div', { key: 'actions', className: 'flex justify-center gap-4' }, [
                                        React.createElement('button',
                                            {
                                                key: 'dark-toggle',
                                                onClick: () => setDarkMode(!darkMode),
                                                className: `p-3 rounded-lg ${darkMode ? 'bg-gray-700 hover:bg-gray-600' : 'bg-gray-100 hover:bg-gray-200'} transition-colors`
                                            },
                                            darkMode ? React.createElement(Sun, { className: 'w-6 h-6' }) : React.createElement(Moon, { className: 'w-6 h-6' })
                                        )
                                    ])
                                ]
                            ),

                            // Upload Area
                            React.createElement('div', 
                                { key: 'upload', className: `${darkMode ? 'bg-gray-800' : 'bg-white'} rounded-lg shadow-sm p-8 mb-8` },
                                [
                                    loading ? 
                                        React.createElement('div', { key: 'loading', className: 'text-center py-12' }, [
                                            React.createElement(RefreshCw, { key: 'spinner', className: 'w-12 h-12 animate-spin mx-auto mb-4 text-blue-600' }),
                                            React.createElement('p', { key: 'text', className: 'text-lg' }, 'Bestand wordt verwerkt...')
                                        ])
                                        :
                                        React.createElement(FileUploadArea, { key: 'upload-area' })
                                ]
                            ),

                            // Error Display
                            uploadError && React.createElement('div', 
                                { key: 'error', className: 'bg-red-50 dark:bg-red-900 border border-red-200 dark:border-red-700 rounded-lg p-6 mb-8' },
                                [
                                    React.createElement('div', { key: 'error-content', className: 'flex items-center gap-3' }, [
                                        React.createElement(AlertTriangle, { key: 'icon', className: 'w-6 h-6 text-red-600 flex-shrink-0' }),
                                        React.createElement('div', { key: 'text' }, [
                                            React.createElement('h3', { key: 'title', className: 'font-medium text-red-800 dark:text-red-200' }, 'Upload Fout'),
                                            React.createElement('p', { key: 'message', className: 'text-red-600 dark:text-red-300 mt-1' }, uploadError)
                                        ])
                                    ])
                                ]
                            ),

                            // Instructions
                            React.createElement('div', 
                                { key: 'instructions', className: `${darkMode ? 'bg-gray-800' : 'bg-white'} rounded-lg shadow-sm p-6` },
                                [
                                    React.createElement('h2', { key: 'title', className: 'text-xl font-semibold mb-4' }, 'Instructies'),
                                    React.createElement('div', { key: 'content', className: 'space-y-3' }, [
                                        React.createElement('div', { key: 'step1', className: 'flex items-start gap-3' }, [
                                            React.createElement('div', { key: 'number', className: 'w-6 h-6 bg-blue-600 text-white rounded-full flex items-center justify-center text-sm font-medium' }, '1'),
                                            React.createElement('p', { key: 'text', className: `${darkMode ? 'text-gray-300' : 'text-gray-600'}` }, 'Upload een Excel bestand (.xlsx) met IPC request data')
                                        ]),
                                        React.createElement('div', { key: 'step2', className: 'flex items-start gap-3' }, [
                                            React.createElement('div', { key: 'number', className: 'w-6 h-6 bg-blue-600 text-white rounded-full flex items-center justify-center text-sm font-medium' }, '2'),
                                            React.createElement('p', { key: 'text', className: `${darkMode ? 'text-gray-300' : 'text-gray-600'}` }, 'Zorg dat het bestand een "Data" sheet bevat met de juiste kolommen')
                                        ]),
                                        React.createElement('div', { key: 'step3', className: 'flex items-start gap-3' }, [
                                            React.createElement('div', { key: 'number', className: 'w-6 h-6 bg-blue-600 text-white rounded-full flex items-center justify-center text-sm font-medium' }, '3'),
                                            React.createElement('p', { key: 'text', className: `${darkMode ? 'text-gray-300' : 'text-gray-600'}` }, 'Verken de data met interactieve grafieken en filters')
                                        ])
                                    ])
                                ]
                            )
                        ])
                    ]
                );
            }

            return React.createElement('div', 
                { className: `min-h-screen transition-colors duration-300 ${darkMode ? 'bg-gray-900 text-white' : 'bg-gray-50 text-gray-900'} p-6` },
                [
                    // Notifications
                    React.createElement('div', { key: 'notifications', className: 'fixed top-4 right-4 z-50 space-y-2' },
                        notifications.map(notification =>
                            React.createElement('div',
                                {
                                    key: notification.id,
                                    className: `p-3 rounded-lg shadow-lg border-l-4 animate-slide-in ${
                                        notification.type === 'error' ? 'bg-red-50 border-red-500 text-red-700' :
                                        notification.type === 'success' ? 'bg-green-50 border-green-500 text-green-700' :
                                        'bg-blue-50 border-blue-500 text-blue-700'
                                    }`
                                },
                                React.createElement('span', { className: 'text-sm font-medium' }, notification.message)
                            )
                        )
                    ),

                    React.createElement('div', { key: 'main', className: 'max-w-7xl mx-auto' }, [
                        // Header
                        React.createElement('div', 
                            { key: 'header', className: `${darkMode ? 'bg-gray-800' : 'bg-white'} rounded-lg shadow-sm p-6 mb-6` },
                            React.createElement('div', { className: 'flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4' }, [
                                React.createElement('div', { key: 'title-section' }, [
                                    React.createElement('h1', 
                                        { className: 'text-3xl font-bold mb-2 bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent' },
                                        'IPC Requests Analyse Dashboard'
                                    ),
                                    React.createElement('p', 
                                        { className: `${darkMode ? 'text-gray-300' : 'text-gray-600'}` },
                                        `Analyseer ${data.length.toLocaleString()} records | Data kwaliteit: ${stats.dataQuality.toFixed(1)}%`
                                    )
                                ]),
                                React.createElement('div', { key: 'actions', className: 'flex items-center gap-3' }, [
                                    React.createElement('button',
                                        {
                                            onClick: () => setDarkMode(!darkMode),
                                            className: `p-2 rounded-lg ${darkMode ? 'bg-gray-700 hover:bg-gray-600' : 'bg-gray-100 hover:bg-gray-200'} transition-colors`
                                        },
                                        darkMode ? React.createElement(Sun, { className: 'w-5 h-5' }) : React.createElement(Moon, { className: 'w-5 h-5' })
                                    ),
                                    React.createElement('div', { className: 'relative group' }, [
                                        React.createElement('button', 
                                            { className: `flex items-center gap-2 px-4 py-2 rounded-lg ${darkMode ? 'bg-gray-700 hover:bg-gray-600' : 'bg-blue-600 hover:bg-blue-700'} text-white transition-colors` },
                                            [
                                                React.createElement(Download, { key: 'icon', className: 'w-4 h-4' }),
                                                React.createElement('span', { key: 'text' }, 'Export'),
                                                React.createElement(ChevronDown, { key: 'chevron', className: 'w-4 h-4' })
                                            ]
                                        ),
                                        React.createElement('div', 
                                            { className: 'absolute right-0 mt-2 w-48 bg-white dark:bg-gray-800 rounded-lg shadow-lg border dark:border-gray-700 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all' },
                                            [
                                                React.createElement('button', 
                                                    { 
                                                        key: 'excel',
                                                        onClick: () => exportData('excel'),
                                                        className: 'w-full text-left px-4 py-2 hover:bg-gray-50 dark:hover:bg-gray-700 rounded-t-lg'
                                                    }, 
                                                    'Excel (.xlsx)'
                                                ),
                                                React.createElement('button', 
                                                    { 
                                                        key: 'csv',
                                                        onClick: () => exportData('csv'),
                                                        className: 'w-full text-left px-4 py-2 hover:bg-gray-50 dark:hover:bg-gray-700 rounded-b-lg'
                                                    }, 
                                                    'CSV'
                                                )
                                            ]
                                        )
                                    ])
                                ])
                            ])
                        ),

                        // Filters
                        React.createElement('div', 
                            { key: 'filters', className: `${darkMode ? 'bg-gray-800' : 'bg-white'} rounded-lg shadow-sm p-6 mb-6` },
                            [
                                React.createElement('div', { key: 'filter-header', className: 'flex items-center gap-2 mb-4' }, [
                                    React.createElement(Filter, { className: 'w-5 h-5 text-gray-600 dark:text-gray-400' }),
                                    React.createElement('h2', { className: 'text-lg font-semibold' }, 'Filters')
                                ]),
                                React.createElement('div', { key: 'filter-content', className: 'space-y-4' }, [
                                    // Search
                                    React.createElement('div', { className: 'relative' }, [
                                        React.createElement(Search, { className: 'absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400' }),
                                        React.createElement('input', {
                                            type: 'text',
                                            placeholder: 'Zoek in verzekeraars, producten, gebruikers...',
                                            value: filters.searchTerm,
                                            onChange: (e) => setFilters(prev => ({ ...prev, searchTerm: e.target.value })),
                                            className: `w-full pl-10 pr-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 ${
                                                darkMode ? 'bg-gray-700 border-gray-600 text-white' : 'bg-white border-gray-300'
                                            }`
                                        })
                                    ]),
                                    
                                    React.createElement('div', { className: 'grid grid-cols-1 lg:grid-cols-4 gap-4' }, [
                                        // Environment filter
                                        React.createElement('div', { key: 'env-filter' }, [
                                            React.createElement('label', { className: 'block text-sm font-medium mb-2' }, 'Environment'),
                                            React.createElement('div', 
                                                { className: `border rounded-lg p-2 max-h-32 overflow-y-auto ${darkMode ? 'border-gray-600 bg-gray-700' : 'border-gray-300 bg-white'}` },
                                                uniqueValues.environments.map(env =>
                                                    React.createElement('label', 
                                                        { 
                                                            key: env,
                                                            className: 'flex items-center gap-2 p-1 hover:bg-gray-50 dark:hover:bg-gray-600 rounded cursor-pointer' 
                                                        },
                                                        [
                                                            React.createElement('input', {
                                                                key: 'checkbox',
                                                                type: 'checkbox',
                                                                checked: filters.environment.includes(env),
                                                                onChange: () => handleMultiSelectFilter('environment', env),
                                                                className: 'w-4 h-4 text-blue-600 rounded focus:ring-blue-500'
                                                            }),
                                                            React.createElement('span', { key: 'label', className: 'text-sm' }, env)
                                                        ]
                                                    )
                                                )
                                            )
                                        ]),

                                        // Insurer filter
                                        React.createElement('div', { key: 'insurer-filter' }, [
                                            React.createElement('label', { className: 'block text-sm font-medium mb-2' }, 'Verzekeraar'),
                                            React.createElement('div', 
                                                { className: `border rounded-lg p-2 max-h-32 overflow-y-auto ${darkMode ? 'border-gray-600 bg-gray-700' : 'border-gray-300 bg-white'}` },
                                                uniqueValues.insurers.slice(0, 15).map(insurer =>
                                                    React.createElement('label', 
                                                        { 
                                                            key: insurer,
                                                            className: 'flex items-center gap-2 p-1 hover:bg-gray-50 dark:hover:bg-gray-600 rounded cursor-pointer' 
                                                        },
                                                        [
                                                            React.createElement('input', {
                                                                key: 'checkbox',
                                                                type: 'checkbox',
                                                                checked: filters.insurer.includes(insurer),
                                                                onChange: () => handleMultiSelectFilter('insurer', insurer),
                                                                className: 'w-4 h-4 text-blue-600 rounded focus:ring-blue-500'
                                                            }),
                                                            React.createElement('span', { key: 'label', className: 'text-sm truncate', title: insurer }, 
                                                                insurer.length > 20 ? insurer.substring(0, 20) + '...' : insurer
                                                            )
                                                        ]
                                                    )
                                                )
                                            )
                                        ]),

                                        // Product filter
                                        React.createElement('div', { key: 'product-filter' }, [
                                            React.createElement('label', { className: 'block text-sm font-medium mb-2' }, 'Product'),
                                            React.createElement('div', 
                                                { className: `border rounded-lg p-2 max-h-32 overflow-y-auto ${darkMode ? 'border-gray-600 bg-gray-700' : 'border-gray-300 bg-white'}` },
                                                uniqueValues.products.slice(0, 15).map(product =>
                                                    React.createElement('label', 
                                                        { 
                                                            key: product,
                                                            className: 'flex items-center gap-2 p-1 hover:bg-gray-50 dark:hover:bg-gray-600 rounded cursor-pointer' 
                                                        },
                                                        [
                                                            React.createElement('input', {
                                                                key: 'checkbox',
                                                                type: 'checkbox',
                                                                checked: filters.product.includes(product),
                                                                onChange: () => handleMultiSelectFilter('product', product),
                                                                className: 'w-4 h-4 text-blue-600 rounded focus:ring-blue-500'
                                                            }),
                                                            React.createElement('span', { key: 'label', className: 'text-sm truncate', title: product }, 
                                                                product.length > 20 ? product.substring(0, 20) + '...' : product
                                                            )
                                                        ]
                                                    )
                                                )
                                            )
                                        ]),

                                        // Date Range filter
                                        React.createElement('div', { key: 'date-filter' }, [
                                            React.createElement('label', { className: 'block text-sm font-medium mb-2' }, 'Periode'),
                                            React.createElement('select', {
                                                value: filters.dateRange,
                                                onChange: (e) => setFilters(prev => ({ ...prev, dateRange: e.target.value })),
                                                className: `w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 ${
                                                    darkMode ? 'bg-gray-700 border-gray-600 text-white' : 'bg-white border-gray-300'
                                                }`
                                            }, [
                                                React.createElement('option', { key: 'all', value: 'all' }, 'Alle periodes'),
                                                React.createElement('option', { key: '1month', value: '1month' }, 'Laatste maand'),
                                                React.createElement('option', { key: '3months', value: '3months' }, 'Laatste 3 maanden'),
                                                React.createElement('option', { key: '6months', value: '6months' }, 'Laatste 6 maanden'),
                                                React.createElement('option', { key: '1year', value: '1year' }, 'Laatste jaar')
                                            ])
                                        ])
                                    ])
                                ])
                            ]
                        ),

                        // Statistics Cards
                        React.createElement('div', 
                            { key: 'stats', className: 'grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 xl:grid-cols-6 gap-4 mb-6' },
                            [
                                {
                                    title: 'Totaal Requests',
                                    value: stats.totalRequests.toLocaleString(),
                                    icon: TrendingUp,
                                    color: 'blue'
                                },
                                {
                                    title: 'Unieke Gebruikers',
                                    value: stats.uniqueUsers.toLocaleString(),
                                    icon: Users,
                                    color: 'green'
                                },
                                {
                                    title: 'Producten',
                                    value: stats.uniqueProducts,
                                    icon: Package,
                                    color: 'purple'
                                },
                                {
                                    title: 'Verzekeraars',
                                    value: stats.uniqueInsurers,
                                    icon: Database,
                                    color: 'orange'
                                },
                                {
                                    title: 'Gem. per Maand',
                                    value: stats.avgPerMonth.toLocaleString(),
                                    icon: Calendar,
                                    color: 'pink'
                                },
                                {
                                    title: 'Data Kwaliteit',
                                    value: `${stats.dataQuality.toFixed(1)}%`,
                                    icon: Eye,
                                    color: 'cyan'
                                }
                            ].map((stat, index) =>
                                React.createElement('div', 
                                    { 
                                        key: index,
                                        className: `${darkMode ? 'bg-gray-800' : 'bg-white'} rounded-lg shadow-sm p-4 border-l-4 border-${stat.color}-500 hover:shadow-md transition-shadow`
                                    },
                                    React.createElement('div', { className: 'flex items-center justify-between' }, [
                                        React.createElement('div', { key: 'content' }, [
                                            React.createElement('p', 
                                                { className: `text-sm font-medium ${darkMode ? 'text-gray-400' : 'text-gray-600'}` },
                                                stat.title
                                            ),
                                            React.createElement('p', { className: 'text-2xl font-bold mt-1' }, stat.value)
                                        ]),
                                        React.createElement(stat.icon, { key: 'icon', className: `w-8 h-8 text-${stat.color}-600` })
                                    ])
                                )
                            )
                        ),

                        // Charts
                        React.createElement('div', { key: 'charts', className: 'grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6' }, [
                            // Monthly Trend
                            React.createElement('div', 
                                { key: 'monthly', className: `${darkMode ? 'bg-gray-800' : 'bg-white'} rounded-lg shadow-sm p-6` },
                                [
                                    React.createElement('h3', { key: 'title', className: 'text-lg font-semibold mb-4' }, 'Maandelijkse Trend'),
                                    React.createElement(ResponsiveContainer, { key: 'chart', width: '100%', height: 300 },
                                        React.createElement(AreaChart, { data: getMonthlyData() }, [
                                            React.createElement(CartesianGrid, { key: 'grid', strokeDasharray: '3 3', stroke: darkMode ? '#374151' : '#e5e7eb' }),
                                            React.createElement(XAxis, { key: 'xaxis', dataKey: 'month', stroke: darkMode ? '#9ca3af' : '#6b7280' }),
                                            React.createElement(YAxis, { key: 'yaxis', stroke: darkMode ? '#9ca3af' : '#6b7280' }),
                                            React.createElement(Tooltip, { 
                                                key: 'tooltip',
                                                formatter: (value) => [value.toLocaleString(), 'Requests'],
                                                contentStyle: {
                                                    backgroundColor: darkMode ? '#1f2937' : '#ffffff',
                                                    border: '1px solid ' + (darkMode ? '#374151' : '#e5e7eb'),
                                                    borderRadius: '0.5rem'
                                                }
                                            }),
                                            React.createElement(Area, { 
                                                key: 'area',
                                                type: 'monotone', 
                                                dataKey: 'requests', 
                                                stroke: '#3b82f6', 
                                                fill: '#3b82f6', 
                                                fillOpacity: 0.6 
                                            })
                                        ])
                                    )
                                ]
                            ),

                            // Environment Distribution
                            React.createElement('div', 
                                { key: 'environment', className: `${darkMode ? 'bg-gray-800' : 'bg-white'} rounded-lg shadow-sm p-6` },
                                [
                                    React.createElement('h3', { key: 'title', className: 'text-lg font-semibold mb-4' }, 'Environment Verdeling'),
                                    React.createElement(ResponsiveContainer, { key: 'chart', width: '100%', height: 300 },
                                        React.createElement(PieChart, {}, [
                                            React.createElement(Pie, {
                                                key: 'pie',
                                                data: getEnvironmentData(),
                                                cx: '50%',
                                                cy: '50%',
                                                labelLine: false,
                                                label: ({ environment, share }) => `${environment} (${share.toFixed(1)}%)`,
                                                outerRadius: 80,
                                                fill: '#8884d8',
                                                dataKey: 'requests'
                                            }, getEnvironmentData().map((entry, index) =>
                                                React.createElement(Cell, { 
                                                    key: `cell-${index}`, 
                                                    fill: colors[index % colors.length] 
                                                })